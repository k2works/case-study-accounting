
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="財務会計システムの設計・開発ドキュメント">
      
      
        <meta name="author" content="Project Team">
      
      
      
        <link rel="prev" href="../chapter30/">
      
      
        <link rel="next" href="../chapter32/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>chapter31 - 財務会計システム ケーススタディ</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#31" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="財務会計システム ケーススタディ" class="md-header__button md-logo" aria-label="財務会計システム ケーススタディ" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            財務会計システム ケーススタディ
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              chapter31
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k2works/case-study-accounting" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    case-study-accounting
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../requirements/requirements_definition/" class="md-tabs__link">
          
  
  
  要件

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../design/architecture_backend/" class="md-tabs__link">
          
  
  
  設計

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../development/release_plan/" class="md-tabs__link">
          
  
  
  開発

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../operation/dev_env/" class="md-tabs__link">
          
  
  
  運用

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../reference/%E9%96%8B%E7%99%BA%E3%82%AC%E3%82%A4%E3%83%89/" class="md-tabs__link">
          
  
  
  リファレンス

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../template/ADR/" class="md-tabs__link">
          
  
  
  テンプレート

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  実践ガイド

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../functional-java/" class="md-tabs__link">
          
  
  
  関数型プログラミング実践ガイド

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="財務会計システム ケーススタディ" class="md-nav__button md-logo" aria-label="財務会計システム ケーススタディ" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    財務会計システム ケーススタディ
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k2works/case-study-accounting" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    case-study-accounting
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    要件
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    要件
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../requirements/requirements_definition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    要件定義書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../requirements/business_usecase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ビジネスユースケース
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../requirements/system_usecase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    システムユースケース
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../requirements/user_story/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ユーザーストーリー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    アーキテクチャ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    アーキテクチャ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/architecture_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    バックエンド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/architecture_frontend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    フロントエンド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/architecture_infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    インフラストラクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    モデル設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    モデル設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/data-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    データモデル
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/domain-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ドメインモデル
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ユースケース設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    ユースケース設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/usecase/JNL-004-01_GetJournalEntries_UseCase_Design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    仕訳一覧取得
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ワークフロー設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    ワークフロー設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/journal-entry-status-diagram/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    仕訳ステータス遷移図
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/ui-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI 設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/test_strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    テスト戦略
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/non_functional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    非機能要件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/operation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用要件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../design/tech_stack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    技術スタック選定
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    開発
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    開発
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/release_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    リリース計画
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    リリースノート
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    リリースノート
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/release_notes-v1.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v1.0 MVP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/release_notes-v2.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v2.0 機能拡張版
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/release_notes-v3.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    v3.0 完成版
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    リリース報告書
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    リリース報告書
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/release_3_report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release 3.0 報告書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    イテレーション計画
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    イテレーション計画
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション9
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション11
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/iteration_plan-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション12
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ふりかえり
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    ふりかえり
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション9
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/retrospective-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション11
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    運用
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    運用
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/dev_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    開発環境解説
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/dev_container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    開発コンテナ構築手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/backend_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    バックエンド構築手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/backend_demo_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    バックエンドデモ環境
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/frontend_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    フロントエンド構築手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/frontend_dev/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    フロントエンド開発手順
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/frontend_common_ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    フロントエンド共通 UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/frontend_demo_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    フロントエンドデモ環境
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/deploy_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    デモ環境デプロイ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/third_party_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    外部サービス連携
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/sonarqube_setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SonarQube セットアップガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/e2e_test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E2E テスト実行手順書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../operation/github_project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub Project 運用ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    リファレンス
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    リファレンス
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    開発ガイドライン
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    開発ガイドライン
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E9%96%8B%E7%99%BA%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    開発ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%82%88%E3%81%84%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%A8%E3%81%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    よいソフトウェアとは
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A8%E3%83%86%E3%82%B9%E3%83%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    コーディングとテストガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%A0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    エクストリームプログラミング
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    分析・設計ガイド
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    分析・設計ガイド
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E8%A6%81%E4%BB%B6%E5%AE%9A%E7%BE%A9%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    要件定義ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9%E4%BD%9C%E6%88%90%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ユースケース作成ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E5%88%86%E6%9E%90%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ビジネスアーキテクチャ分析ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E8%A8%AD%E8%A8%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ビジネスアーキテクチャ設計ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3%E8%A8%AD%E8%A8%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    アーキテクチャ設計ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%A2%E3%83%87%E3%83%AB%E8%A8%AD%E8%A8%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    データモデル設計ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%A2%E3%83%87%E3%83%AB%E8%A8%AD%E8%A8%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ドメインモデル設計ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/UI%E8%A8%AD%E8%A8%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI設計ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E8%A8%AD%E8%A8%88%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    インフラ設計ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    非機能・運用ガイド
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    非機能・運用ガイド
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%86%E3%82%B9%E3%83%88%E6%88%A6%E7%95%A5%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    テスト戦略ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E9%9D%9E%E6%A9%9F%E8%83%BD%E8%A6%81%E4%BB%B6%E5%AE%9A%E7%BE%A9%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    非機能要件定義ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E9%81%8B%E7%94%A8%E8%A6%81%E4%BB%B6%E5%AE%9A%E7%BE%A9%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    運用要件定義ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%83%BB%E3%82%A4%E3%83%86%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%88%E7%94%BB%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    リリース・イテレーション計画ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    リリースガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    環境構築ガイド
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    環境構築ガイド
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/Java%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Javaアプリケーション環境構築ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/TypeScript%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    TypeScriptアプリケーション環境構築ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E8%A8%80%E8%AA%9E%E5%88%A5%E9%96%8B%E7%99%BA%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    言語別開発ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E7%AE%A1%E7%90%86%E3%82%AC%E3%82%A4%E3%83%89/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    環境変数管理ガイド
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/Vim%E6%93%8D%E4%BD%9C%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vim操作マニュアル
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/CodexCLIMCP%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E8%A8%AD%E5%AE%9A%E6%89%8B%E9%A0%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Codex CLI MCP サーバー設定手順
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/CodexCLIMCP%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E9%96%8B%E7%99%BA%E3%83%95%E3%83%AD%E3%83%BC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Codex CLI MCP アプリケーション開発フロー
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    テンプレート
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    テンプレート
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/ADR/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ビジネスアーキテクチャ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E3%82%A4%E3%83%86%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E5%AE%8C%E4%BA%86%E5%A0%B1%E5%91%8A%E6%9B%B8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション完了報告書
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E3%82%A4%E3%83%86%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E8%A8%88%E7%94%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イテレーション計画
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E3%82%A4%E3%83%B3%E3%82%BB%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%87%E3%83%83%E3%82%AD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    インセプションデッキ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E3%81%BE%E3%81%9A%E3%81%93%E3%82%8C%E3%82%92%E8%AA%AD%E3%82%82%E3%81%86%E3%83%AA%E3%82%B9%E3%83%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    まずこれを読もうリスト
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E3%83%AA%E3%83%AA%E3%83%BC%E3%82%B9%E8%A8%88%E7%94%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    リリース計画
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E5%AE%8C%E5%85%A8%E5%BD%A2%E5%BC%8F%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    完全形式のユースケース
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E8%A6%81%E4%BB%B6%E5%AE%9A%E7%BE%A9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    要件定義
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/%E8%A8%AD%E8%A8%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    設計
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    README
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    実践ガイド
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    実践ガイド
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" checked>
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    バックエンド編（Java版）
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    バックエンド編（Java版）
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter00/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    はじめに
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter25/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第25章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter26/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第26章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter27/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第27章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter28/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第28章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第29章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter30/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第30章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    第31章
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    第31章
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#311" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.1 イベントソーシングの基礎
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.1 イベントソーシングの基礎">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントソーシングとは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントソーシングの3つの原則
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crud" class="md-nav__link">
    <span class="md-ellipsis">
      
        CRUD との違い
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントソーシングの利点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントソーシングの課題
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        適用ケース
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#312" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.2 イベントストアの設計
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.2 イベントストアの設計">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントストアの要件
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      
        テーブル設計（PostgreSQL）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        スキーマの詳細説明
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlation_id-causation_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        correlation_id と causation_id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントのバージョニング
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#313" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.3 仕訳のイベントソーシング実装
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.3 仕訳のイベントソーシング実装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        ドメインイベントの定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aggregate パターンの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントストアリポジトリ
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#314-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.4 CQRS パターン
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.4 CQRS パターン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        CQRS とは
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-side" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Side の実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-side" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Side（読み取りモデル）の実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        読み取りモデルのテーブル
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Service
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#315" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.5 スナップショットと最適化
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.5 スナップショットと最適化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        スナップショットの必要性
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        スナップショットテーブル
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        スナップショットの実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        スナップショット対応の Aggregate 再生
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#316-tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.6 TDD による実装例
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.6 TDD による実装例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        イベントソーシングのテスト
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#317" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.7 まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.7 まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        学んだこと
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        財務会計システムへの適用
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        導入の判断基準
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第32章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    フロントエンド編（React版）
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    フロントエンド編（React版）
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter00/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    はじめに
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第1章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第2章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第3章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第4章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第5章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第6章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第7章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第8章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第9章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第10章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第11章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第12章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第13章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第14章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第15章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第16章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第17章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第18章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter19/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第19章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter20/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第20章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter21/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第21章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter22/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第22章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter23/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第23章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../frontend/chapter24/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    第24章
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    関数型プログラミング実践ガイド
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    関数型プログラミング実践ガイド
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
        
          
          <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    関数型プログラミング（Java版）
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    関数型プログラミング（Java版）
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    はじめに
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/part-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part I 基礎
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/part-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part II 関数型スタイル
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/part-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part III エラーハンドリング
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/part-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part IV IO と副作用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/part-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part V 並行処理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functional-java/part-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Part VI 実践
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="31">第31章: イベントソーシング<a class="headerlink" href="#31" title="Permanent link">&para;</a></h1>
<h2 id="311">31.1 イベントソーシングの基礎<a class="headerlink" href="#311" title="Permanent link">&para;</a></h2>
<h3 id="_1">イベントソーシングとは<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>イベントソーシングは、アプリケーションの状態をイベントの連続として記録する設計パターンです。従来の CRUD アプローチでは「現在の状態」のみを保存しますが、イベントソーシングでは「状態に至った経緯（イベント）」を保存します。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMT8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjQ2M3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NzYzcHg7aGVpZ2h0OjQ2M3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc2MyA0NjMiIHdpZHRoPSI3NjNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPkNSVUQgdnMgJiMxMjQ1MjsmIzEyNTA1OyYjMTI1MzE7JiMxMjQ4ODsmIzEyNDc3OyYjMTI1NDA7JiMxMjQ3MTsmIzEyNTMxOyYjMTI0NjQ7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk3LjI1MDQiIHg9IjI3NS45MzQ4IiB5PSIyMi45OTUxIj5DUlVEIHZzICYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQ3NzsmIzEyNTQwOyYjMTI0NzE7JiMxMjUzMTsmIzEyNDY0OzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgQ1JVRCA/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDUlVEIC4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMiI+PHBhdGggZD0iTTQ1LjA2LDI2OS4yOTY5IEwxNjQuOTc3NywyNjkuMjk2OSBBMy43NSwzLjc1IDAgMCAxIDE2Ny40Nzc3LDI3MS43OTY5IEwxNzQuNDc3NywyOTEuNTkzOCBMMjEwLjA2LDI5MS41OTM4IEEyLjUsMi41IDAgMCAxIDIxMi41NiwyOTQuMDkzOCBMMjEyLjU2LDQ1My43OTY5IEEyLjUsMi41IDAgMCAxIDIxMC4wNiw0NTYuMjk2OSBMNDUuMDYsNDU2LjI5NjkgQTIuNSwyLjUgMCAwIDEgNDIuNTYsNDUzLjc5NjkgTDQyLjU2LDI3MS43OTY5IEEyLjUsMi41IDAgMCAxIDQ1LjA2LDI2OS4yOTY5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI0Mi41NiIgeDI9IjE3NC40Nzc3IiB5MT0iMjkxLjU5MzgiIHkyPSIyOTEuNTkzOCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTguOTE3NyIgeD0iNDYuNTYiIHk9IjI4NC4yOTIiPkNSVUQgJiMxMjQ1MDsmIzEyNTAzOyYjMTI1MjU7JiMxMjU0MDsmIzEyNDgxOzwvdGV4dD48L2c+PCEtLWNsdXN0ZXIgPz8/Pz8/Pz8/LS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJlbnQwMDA3Ij48cGF0aCBkPSJNOC41LDQzLjI5NjkgTDEzNS40OTk1LDQzLjI5NjkgQTMuNzUsMy43NSAwIDAgMSAxMzcuOTk5NSw0NS43OTY5IEwxNDQuOTk5NSw2NS41OTM4IEw3NTMuNjIsNjUuNTkzOCBBMi41LDIuNSAwIDAgMSA3NTYuMTIsNjguMDkzOCBMNzU2LjEyLDI0Mi43OTY5IEEyLjUsMi41IDAgMCAxIDc1My42MiwyNDUuMjk2OSBMOC41LDI0NS4yOTY5IEEyLjUsMi41IDAgMCAxIDYsMjQyLjc5NjkgTDYsNDUuNzk2OSBBMi41LDIuNSAwIDAgMSA4LjUsNDMuMjk2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNiIgeDI9IjE0NC45OTk1IiB5MT0iNjUuNTkzOCIgeTI9IjY1LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI1Ljk5OTUiIHg9IjEwIiB5PSI1OC4yOTIiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMxMjQ3NzsmIzEyNTQwOyYjMTI0NzE7JiMxMjUzMTsmIzEyNDY0OzwvdGV4dD48L2c+PCEtLWVudGl0eSBjcnVkX2RiLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ1JVRCAuLi4uLi5jcnVkX2RiIiBkYXRhLXNvdXJjZS1saW5lPSI1IiBpZD0iZW50MDAwMyI+PHBhdGggZD0iTTg2LjAzLDQwNC42NDY5IEM4Ni4wMywzOTQuNjQ2OSAxMjcuNTY0MiwzOTQuNjQ2OSAxMjcuNTY0MiwzOTQuNjQ2OSBDMTI3LjU2NDIsMzk0LjY0NjkgMTY5LjA5ODQsMzk0LjY0NjkgMTY5LjA5ODQsNDA0LjY0NjkgTDE2OS4wOTg0LDQyOS45NDM4IEMxNjkuMDk4NCw0MzkuOTQzOCAxMjcuNTY0Miw0MzkuOTQzOCAxMjcuNTY0Miw0MzkuOTQzOCBDMTI3LjU2NDIsNDM5Ljk0MzggODYuMDMsNDM5Ljk0MzggODYuMDMsNDI5Ljk0MzggTDg2LjAzLDQwNC42NDY5IiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNODYuMDMsNDA0LjY0NjkgQzg2LjAzLDQxNC42NDY5IDEyNy41NjQyLDQxNC42NDY5IDEyNy41NjQyLDQxNC42NDY5IEMxMjcuNTY0Miw0MTQuNjQ2OSAxNjkuMDk4NCw0MTQuNjQ2OSAxNjkuMDk4NCw0MDQuNjQ2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjMuMDY4NCIgeD0iOTYuMDMiIHk9IjQzMS42NDIiPmFjY291bnRzPC90ZXh0PjwvZz48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJDUlVEIC4uLi4uLkdNTjQiIGRhdGEtc291cmNlLWxpbmU9IjciIGlkPSJlbnQwMDA1Ij48cGF0aCBkPSJNNTguNTYsMzA0LjU5NjkgTDU4LjU2LDM1OS45OTUzIEEwLDAgMCAwIDAgNTguNTYsMzU5Ljk5NTMgTDEyMy41NiwzNTkuOTk1MyBMMTI3LjU2LDM5NC4zODY5IEwxMzEuNTYsMzU5Ljk5NTMgTDE5Ni41NjAxLDM1OS45OTUzIEEwLDAgMCAwIDAgMTk2LjU2MDEsMzU5Ljk5NTMgTDE5Ni41NjAxLDMxNC41OTY5IEwxODYuNTYwMSwzMDQuNTk2OSBMNTguNTYsMzA0LjU5NjkgQTAsMCAwIDAgMCA1OC41NiwzMDQuNTk2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTE4Ni41NjAxLDMwNC41OTY5IEwxODYuNTYwMSwzMTQuNTk2OSBMMTk2LjU2MDEsMzE0LjU5NjkgTDE4Ni41NjAxLDMwNC41OTY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTcuMDAwMSIgeD0iNjQuNTYiIHk9IjMyMS42NjM4Ij4mIzI5Njk0OyYjMjIzMTI7JiMxMjM5ODsmIzI5MzY2OyYjMjQ5MDc7JiMxMjM5ODsmIzEyNDE1OyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iNjQuNTYiIHk9IjMzNi43OTY2Ij4mIzI2MzU2OyYjMjYwMzI7JiMyNjE3ODsmIzEyMzk1OyYjMTk5Nzg7JiMyNjM2MDsmIzEyMzY1OzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MS4wMDAxIiB4PSI2NC41NiIgeT0iMzUxLjkyOTQiPiYjMjM2NTM7JiMyNzUwODsmIzEyMzk5OyYjMjI4MzM7JiMxMjQzMTsmIzEyNDI4OyYjMTI0Mjc7PC90ZXh0PjwvZz48IS0tZW50aXR5IGVzX2RiLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLmVzX2RiIiBkYXRhLXNvdXJjZS1saW5lPSIxNCIgaWQ9ImVudDAwMDgiPjxwYXRoIGQ9Ik03Ni4yNiwxOTMuNjQ2OSBDNzYuMjYsMTgzLjY0NjkgMTI3LjU1NTksMTgzLjY0NjkgMTI3LjU1NTksMTgzLjY0NjkgQzEyNy41NTU5LDE4My42NDY5IDE3OC44NTE4LDE4My42NDY5IDE3OC44NTE4LDE5My42NDY5IEwxNzguODUxOCwyMTguOTQzOCBDMTc4Ljg1MTgsMjI4Ljk0MzggMTI3LjU1NTksMjI4Ljk0MzggMTI3LjU1NTksMjI4Ljk0MzggQzEyNy41NTU5LDIyOC45NDM4IDc2LjI2LDIyOC45NDM4IDc2LjI2LDIxOC45NDM4IEw3Ni4yNiwxOTMuNjQ2OSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTc2LjI2LDE5My42NDY5IEM3Ni4yNiwyMDMuNjQ2OSAxMjcuNTU1OSwyMDMuNjQ2OSAxMjcuNTU1OSwyMDMuNjQ2OSBDMTI3LjU1NTksMjAzLjY0NjkgMTc4Ljg1MTgsMjAzLjY0NjkgMTc4Ljg1MTgsMTkzLjY0NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgyLjU5MTgiIHg9Ijg2LjI2IiB5PSIyMjAuNjQyIj5ldmVudF9zdG9yZTwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLkdNTjkiIGRhdGEtc291cmNlLWxpbmU9IjE2IiBpZD0iZW50MDAxMCI+PHBhdGggZD0iTTIyLDc4LjAyNjkgTDIyLDE0OC41NTgxIEEwLDAgMCAwIDAgMjIsMTQ4LjU1ODEgTDEyMy41NiwxNDguNTU4MSBMMTI3LjU2LDE4My40MDY5IEwxMzEuNTYsMTQ4LjU1ODEgTDIzMy4xMTg3LDE0OC41NTgxIEEwLDAgMCAwIDAgMjMzLjExODcsMTQ4LjU1ODEgTDIzMy4xMTg3LDg4LjAyNjkgTDIyMy4xMTg3LDc4LjAyNjkgTDIyLDc4LjAyNjkgQTAsMCAwIDAgMCAyMiw3OC4wMjY5IiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNMjIzLjExODcsNzguMDI2OSBMMjIzLjExODcsODguMDI2OSBMMjMzLjExODcsODguMDI2OSBMMjIzLjExODcsNzguMDI2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTczLjIzMzkiIHg9IjI4IiB5PSI5NS4wOTM4Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OzE6IEFjY291bnRDcmVhdGVkPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE4NC4xODM3IiB4PSIyOCIgeT0iMTEwLjIyNjYiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7MjogQmFsYW5jZUluY3JlYXNlZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTAuMTE4NyIgeD0iMjgiIHk9IjEyNS4zNTk0Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OzM6IEJhbGFuY2VEZWNyZWFzZWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYyLjM1NDEiIHg9IjI4IiB5PSIxNDAuNDkyMiI+JiMzNjg2MTsmIzM1MzUyOyYjMjM1NTQ7JiMyOTk5MjsmIzY1Mjg4O0FwcGVuZC1Pbmx5JiM2NTI4OTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgcmVwbGF5LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLnJlcGxheSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGlkPSJlbnQwMDEyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMy45OTk2IiB4PSIzOTkuMTIiIHk9IjE3MS4xNDY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTUiIHg9IjUwMy4xMTk2IiB5PSIxNzYuMTQ2OSIvPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNCIgeD0iNTAxLjExOTYiIHk9IjE3OC4xNDY5Ii8+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSI0IiB4PSI1MDEuMTE5NiIgeT0iMTgyLjE0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSI0MTQuMTIiIHk9IjIwNC4xNDIiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyMDg3NzsmIzI5OTgzOzwvdGV4dD48L2c+PCEtLWVudGl0eSBzdGF0ZS0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLi5zdGF0ZSIgZGF0YS1zb3VyY2UtbGluZT0iMjMiIGlkPSJlbnQwMDEzIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9Ijg5Ljk5OTciIHg9IjY1MC4xMiIgeT0iMTc2LjE0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OS45OTk3IiB4PSI2NjAuMTIiIHk9IjE5OS4xNDIiPiYjMjk2OTQ7JiMyMjMxMjsmIzEyMzk4OyYjMjkzNjY7JiMyNDkwNzs8L3RleHQ+PC9nPjwhLS1saW5rIGVzX2RiIHRvIHJlcGxheS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDEyIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjUiIGlkPSJsbmsxNCI+PHBhdGggZD0iTTE3OS4yOCwyMDQuNDU2OSBDMjM4LjIzLDIwMi4zMjY5IDMyOS41MDM5LDE5OS4wMjQyIDM5Mi42OTM5LDE5Ni43MzQyIiBmaWxsPSJub25lIiBpZD0iZXNfZGItdG8tcmVwbGF5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzOTguNjksMTk2LjUxNjksMzg5LjU1MSwxOTIuODQ1NCwzOTMuNjkzMywxOTYuNjk4LDM4OS44NDA4LDIwMC44NDAyLDM5OC42OSwxOTYuNTE2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNC4wMDAxIiB4PSIyNjQuMTIiIHk9IjE5My45MTM4Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMzU1MDE7JiMxMjQxNTsmIzM2Nzk2OyYjMTI0MTU7PC90ZXh0PjwvZz48IS0tbGluayByZXBsYXkgdG8gc3RhdGUtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAxMiIgZGF0YS1lbnRpdHktMj0iZW50MDAxMyIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjI2IiBpZD0ibG5rMTUiPjxwYXRoIGQ9Ik01MjMuMzgsMTk0LjI5NjkgQzU2My4xMSwxOTQuMjk2OSA2MDcuOTcsMTk0LjI5NjkgNjQzLjgxLDE5NC4yOTY5IiBmaWxsPSJub25lIiBpZD0icmVwbGF5LXRvLXN0YXRlIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2NDkuODEsMTk0LjI5NjksNjQwLjgxLDE5MC4yOTY5LDY0NC44MSwxOTQuMjk2OSw2NDAuODEsMTk4LjI5NjksNjQ5LjgxLDE5NC4yOTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNjUuMDAwMSIgeD0iNTU0LjEyIiB5PSIxOTAuMzYzOCI+JiMyOTM2NjsmIzI0OTA3OyYjMTI0MzQ7JiMyNDQ4OTsmIzIwODAzOzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgVkw5REltQ241QnBkTHBud3hxNnp6STN1U1Y0YTI5dkJrWGpoU1BpaWtzYjFuQ0RjS1JIUTExNnJMMTZhR2JNZ0JPZndnRXNGVVV2c1JfdTVpc2tqTGlIQklEeENVdmQ5SDFRYW5NMWtRTmFVb1l3V1FnMVZHX3kxX0hyS2gtWHRLSnQ3SHpLYzVia0g4MEt1WFZvZzFCRldDNENNMTJWNGZpT1FwSkQ4OUxER05ROV9XZHVoUmxRejU2bUdhcWdRZXd2Y0tDQ0c5SXhUNTUwTjNBVGFQaXFTdUs4b28wYWZISDc0b2dXeUVFVzVQcXRxeFdRTGZ0MWhKc19Hd3hfcnB1Rk1BR2RoWi01bkV3bWZ6NnhWTllmWF9HTXpBV2F3THM3aDRSdHhlRDUxVE8xZzd6S1VPVG80LTBnby1LRmdGcVI3NVJDb3VwQmhJazZtSDNIcF92M3lNVm12U284M0N2elV2bm42OUpGN3FDYUNwNUFCU2VDalM0Rlp4WXp5UWVKRmlveXl3aHo2cFRFV2hHUDdwVlZrcGVualFzRmZITXdqbHRUdGxxcUlHbkhqbVJOZVNQRjFUZExtVDk1T1M5WGpxTktJdnFUdk5nVVYtbE5LMlNrTEQxd05NOERxVWRoTzFmY25KbkJUajdHZ0tRLWhMcDlhbkVJYU10RTdzUWQzZTdTVFJGYmF5bUMwPz48L2c+PC9zdmc+" class="uml" alt="uml diagram" title="" /></p>
<h3 id="3">イベントソーシングの3つの原則<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<p><strong>1. イベントが真実の源（Source of Truth）</strong></p>
<p>従来の CRUD では「現在の状態」がデータベースに保存されますが、イベントソーシングでは「過去に発生したイベント」が真実の源となります。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMT8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUyNXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6NjAwcHg7aGVpZ2h0OjUyNXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDYwMCA1MjUiIHdpZHRoPSI2MDBweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMzA0OTU7JiMyMzQ1NTsmIzEyMzk4OyYjMjgzMDQ7JiMxMjM5ODsmIzM2OTQ5OyYjMTIzNTY7PC90aXRsZT48ZGVmcy8+PGc+PGcgY2xhc3M9InRpdGxlIiBkYXRhLXNvdXJjZS1saW5lPSIxIj48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTcuOTk5NiIgeD0iMjQ0LjQxMDIiIHk9IjIyLjk5NTEiPiYjMzA0OTU7JiMyMzQ1NTsmIzEyMzk4OyYjMjgzMDQ7JiMxMjM5ODsmIzM2OTQ5OyYjMTIzNTY7PC90ZXh0PjwvZz48IS0tY2x1c3RlciBDUlVELS0+PGcgY2xhc3M9ImNsdXN0ZXIiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNSVUQiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAyIj48cGF0aCBkPSJNOC41LDM0Ni4yOTY5IEw1My41NDM5LDM0Ni4yOTY5IEEzLjc1LDMuNzUgMCAwIDEgNTYuMDQzOSwzNDguNzk2OSBMNjMuMDQzOSwzNjguNTkzOCBMMzE4LjAyLDM2OC41OTM4IEEyLjUsMi41IDAgMCAxIDMyMC41MiwzNzEuMDkzOCBMMzIwLjUyLDUxNS43OTY5IEEyLjUsMi41IDAgMCAxIDMxOC4wMiw1MTguMjk2OSBMOC41LDUxOC4yOTY5IEEyLjUsMi41IDAgMCAxIDYsNTE1Ljc5NjkgTDYsMzQ4Ljc5NjkgQTIuNSwyLjUgMCAwIDEgOC41LDM0Ni4yOTY5IiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI2IiB4Mj0iNjMuMDQzOSIgeTE9IjM2OC41OTM4IiB5Mj0iMzY4LjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQuMDQzOSIgeD0iMTAiIHk9IjM2MS4yOTIiPkNSVUQ8L3RleHQ+PC9nPjwhLS1jbHVzdGVyID8/Pz8/Pz8/Py0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjEyIiBpZD0iZW50MDAwNyI+PHBhdGggZD0iTTU0Ljc2LDQzLjI5NjkgTDE4MS43NTk1LDQzLjI5NjkgQTMuNzUsMy43NSAwIDAgMSAxODQuMjU5NSw0NS43OTY5IEwxOTEuMjU5NSw2NS41OTM4IEw1OTEuMzIsNjUuNTkzOCBBMi41LDIuNSAwIDAgMSA1OTMuODIsNjguMDkzOCBMNTkzLjgyLDMxOS43OTY5IEEyLjUsMi41IDAgMCAxIDU5MS4zMiwzMjIuMjk2OSBMNTQuNzYsMzIyLjI5NjkgQTIuNSwyLjUgMCAwIDEgNTIuMjYsMzE5Ljc5NjkgTDUyLjI2LDQ1Ljc5NjkgQTIuNSwyLjUgMCAwIDEgNTQuNzYsNDMuMjk2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iNTIuMjYiIHgyPSIxOTEuMjU5NSIgeTE9IjY1LjU5MzgiIHkyPSI2NS41OTM4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEyNS45OTk1IiB4PSI1Ni4yNiIgeT0iNTguMjkyIj4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMTI0Nzc7JiMxMjU0MDsmIzEyNDcxOyYjMTI1MzE7JiMxMjQ2NDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgY3J1ZC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkNSVUQuY3J1ZCIgZGF0YS1zb3VyY2UtbGluZT0iNSIgaWQ9ImVudDAwMDMiPjxwYXRoIGQ9Ik05MS41LDQ2Ni42NDY5IEM5MS41LDQ1Ni42NDY5IDE2My4yNTkyLDQ1Ni42NDY5IDE2My4yNTkyLDQ1Ni42NDY5IEMxNjMuMjU5Miw0NTYuNjQ2OSAyMzUuMDE4Myw0NTYuNjQ2OSAyMzUuMDE4Myw0NjYuNjQ2OSBMMjM1LjAxODMsNDkxLjk0MzggQzIzNS4wMTgzLDUwMS45NDM4IDE2My4yNTkyLDUwMS45NDM4IDE2My4yNTkyLDUwMS45NDM4IEMxNjMuMjU5Miw1MDEuOTQzOCA5MS41LDUwMS45NDM4IDkxLjUsNDkxLjk0MzggTDkxLjUsNDY2LjY0NjkiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik05MS41LDQ2Ni42NDY5IEM5MS41LDQ3Ni42NDY5IDE2My4yNTkyLDQ3Ni42NDY5IDE2My4yNTkyLDQ3Ni42NDY5IEMxNjMuMjU5Miw0NzYuNjQ2OSAyMzUuMDE4Myw0NzYuNjQ2OSAyMzUuMDE4Myw0NjYuNjQ2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzLjUxODMiIHg9IjEwMS41IiB5PSI0OTMuNjQyIj5hY2NvdW50cyAmIzEyNDg2OyYjMTI1NDA7JiMxMjUwMjsmIzEyNTIzOzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iQ1JVRC5HTU40IiBkYXRhLXNvdXJjZS1saW5lPSI3IiBpZD0iZW50MDAwNSI+PHBhdGggZD0iTTIyLDM4MS4xNjY5IEwyMiw0MjEuNDMyNSBBMCwwIDAgMCAwIDIyLDQyMS40MzI1IEwxNTkuMjYsNDIxLjQzMjUgTDE2My4yNiw0NTYuNDQ2OSBMMTY3LjI2LDQyMS40MzI1IEwzMDQuNTE3MSw0MjEuNDMyNSBBMCwwIDAgMCAwIDMwNC41MTcxLDQyMS40MzI1IEwzMDQuNTE3MSwzOTEuMTY2OSBMMjk0LjUxNzEsMzgxLjE2NjkgTDIyLDM4MS4xNjY5IEEwLDAgMCAwIDAgMjIsMzgxLjE2NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yOTQuNTE3MSwzODEuMTY2OSBMMjk0LjUxNzEsMzkxLjE2NjkgTDMwNC41MTcxLDM5MS4xNjY5IEwyOTQuNTE3MSwzODEuMTY2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjYxLjUxNzEiIHg9IjI4IiB5PSIzOTguMjMzOCI+aWQ9MTAwMSwgbmFtZT0iJiMyOTY5NDsmIzM3MzI5OyIsIGJhbGFuY2U9NTAwMDA8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTEuMDAwMSIgeD0iMjgiIHk9IjQxMy4zNjY2Ij4mIzI5Njk0OyYjMjIzMTI7JiMxMjM5ODsmIzI5MzY2OyYjMjQ5MDc7JiMxMjM5ODsmIzEyNDE1OzwvdGV4dD48L2c+PCEtLWVudGl0eSBlcy0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9Ii4uLi4uLi4uLi5lcyIgZGF0YS1zb3VyY2UtbGluZT0iMTMiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNMTExLjk2LDE3OS42NDY5IEMxMTEuOTYsMTY5LjY0NjkgMTYzLjI1NTksMTY5LjY0NjkgMTYzLjI1NTksMTY5LjY0NjkgQzE2My4yNTU5LDE2OS42NDY5IDIxNC41NTE4LDE2OS42NDY5IDIxNC41NTE4LDE3OS42NDY5IEwyMTQuNTUxOCwyMDQuOTQzOCBDMjE0LjU1MTgsMjE0Ljk0MzggMTYzLjI1NTksMjE0Ljk0MzggMTYzLjI1NTksMjE0Ljk0MzggQzE2My4yNTU5LDIxNC45NDM4IDExMS45NiwyMTQuOTQzOCAxMTEuOTYsMjA0Ljk0MzggTDExMS45NiwxNzkuNjQ2OSIgZmlsbD0iI0YxRjFGMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTExMS45NiwxNzkuNjQ2OSBDMTExLjk2LDE4OS42NDY5IDE2My4yNTU5LDE4OS42NDY5IDE2My4yNTU5LDE4OS42NDY5IEMxNjMuMjU1OSwxODkuNjQ2OSAyMTQuNTUxOCwxODkuNjQ2OSAyMTQuNTUxOCwxNzkuNjQ2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuNTkxOCIgeD0iMTIxLjk2IiB5PSIyMDYuNjQyIj5ldmVudF9zdG9yZTwvdGV4dD48L2c+PCEtLWVudGl0eSBldjEtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uZXYxIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMDkiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTk1LjExNjIiIHg9IjM3My42MSIgeT0iMjUzLjk5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzUuMTE2MiIgeD0iMzgzLjYxIiB5PSIyNzYuOTkyIj5FdmVudCAxOiBBY2NvdW50Q3JlYXRlZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDQuNzkyIiB4PSIzODMuNjEiIHk9IjI5My4yODg5Ij5pZD0xMDAxLCBiYWxhbmNlPTA8L3RleHQ+PC9nPjwhLS1lbnRpdHkgZXYyLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLmV2MiIgZGF0YS1zb3VyY2UtbGluZT0iMTYiIGlkPSJlbnQwMDEwIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjUyLjU5MzgiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwNi45MDgyIiB4PSIzNjcuNzEiIHk9IjE2NS45OTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTg2LjkwODIiIHg9IjM3Ny43MSIgeT0iMTg4Ljk5MiI+RXZlbnQgMjogQmFsYW5jZUluY3JlYXNlZDwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTkuMTkxNCIgeD0iMzc3LjcxIiB5PSIyMDUuMjg4OSI+YW1vdW50PTEwMDAwMDwvdGV4dD48L2c+PCEtLWVudGl0eSBldjMtLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSIuLi4uLi4uLi4uZXYzIiBkYXRhLXNvdXJjZS1saW5lPSIxNyIgaWQ9ImVudDAwMTEiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNTIuNTkzOCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjEzLjI5OTgiIHg9IjM2NC41MiIgeT0iNzcuOTk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE5My4yOTk4IiB4PSIzNzQuNTIiIHk9IjEwMC45OTIiPkV2ZW50IDM6IEJhbGFuY2VEZWNyZWFzZWQ8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTEwLjI4NDIiIHg9IjM3NC41MiIgeT0iMTE3LjI4ODkiPmFtb3VudD01MDAwMDwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iLi4uLi4uLi4uLkdNTjE1IiBkYXRhLXNvdXJjZS1saW5lPSIyNCIgaWQ9ImVudDAwMTYiPjxwYXRoIGQ9Ik02OC4yNiw5NC4xNjY5IEw2OC4yNiwxMzQuNDMyNSBBMCwwIDAgMCAwIDY4LjI2LDEzNC40MzI1IEwxNTkuMjYsMTM0LjQzMjUgTDE2My4yNiwxNjkuNDQ2OSBMMTY3LjI2LDEzNC40MzI1IEwyNTguMjYwMiwxMzQuNDMyNSBBMCwwIDAgMCAwIDI1OC4yNjAyLDEzNC40MzI1IEwyNTguMjYwMiwxMDQuMTY2OSBMMjQ4LjI2MDIsOTQuMTY2OSBMNjguMjYsOTQuMTY2OSBBMCwwIDAgMCAwIDY4LjI2LDk0LjE2NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik0yNDguMjYwMiw5NC4xNjY5IEwyNDguMjYwMiwxMDQuMTY2OSBMMjU4LjI2MDIsMTA0LjE2NjkgTDI0OC4yNjAyLDk0LjE2NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0My4wMDAyIiB4PSI3NC4yNiIgeT0iMTExLjIzMzgiPiYjMTIzNzc7JiMxMjQwOTsmIzEyMzkwOyYjMTIzOTg7JiMxMjQ1MjsmIzEyNTA1OyYjMTI1MzE7JiMxMjQ4ODsmIzEyNDM0OyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY5LjAwMDIiIHg9Ijc0LjI2IiB5PSIxMjYuMzY2NiI+JiMyMDIxOTsmIzI0ODQ3OyYjMTIzOTg7JiMyNjE3ODsmIzI4ODU3OyYjMTIzOTg7JiMyOTM2NjsmIzI0OTA3OyYjMTI0MzQ7JiMyNDQ4OTsmIzIwODAzOyYjMjE0ODc7JiMzMzAyMTs8L3RleHQ+PC9nPjwhLS1saW5rIGVzIHRvIGV2MS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDA4IiBkYXRhLWVudGl0eS0yPSJlbnQwMDA5IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJsbmsxMiI+PHBhdGggZD0iTTIxNC43NywyMDYuODI2OSBDMjU4LjgxLDIxOS40OTY5IDMxOC4wNDM3LDIzNi41Mzg2IDM3MS40NTM3LDI1MS44OTg2IiBmaWxsPSJub25lIiBpZD0iZXMtdG8tZXYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNzcuMjIsMjUzLjU1NjksMzY5LjY3NjEsMjQ3LjIyNTIsMzcyLjQxNDgsMjUyLjE3NSwzNjcuNDY1LDI1NC45MTM2LDM3Ny4yMiwyNTMuNTU2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjwvZz48IS0tbGluayBlcyB0byBldjItLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwOCIgZGF0YS1lbnRpdHktMj0iZW50MDAxMCIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIwIiBpZD0ibG5rMTMiPjxwYXRoIGQ9Ik0yMTQuNzcsMTkyLjI5NjkgQzI1Ni4xLDE5Mi4yOTY5IDMwOS44OCwxOTIuMjk2OSAzNjEuMjIsMTkyLjI5NjkiIGZpbGw9Im5vbmUiIGlkPSJlcy10by1ldjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM2Ny4yMiwxOTIuMjk2OSwzNTguMjIsMTg4LjI5NjksMzYyLjIyLDE5Mi4yOTY5LDM1OC4yMiwxOTYuMjk2OSwzNjcuMjIsMTkyLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48L2c+PCEtLWxpbmsgZXMgdG8gZXYzLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDgiIGRhdGEtZW50aXR5LTI9ImVudDAwMTEiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgaWQ9ImxuazE0Ij48cGF0aCBkPSJNMjE0Ljg5LDE4MS4xNzY5IEMyNDcuNTIsMTczLjcxNjkgMjkwLjc1LDE2My4yNjY5IDMyOC41MiwxNTIuMjk2OSBDMzUwLjMzLDE0NS45NTY5IDM2OC4xMDkxLDE0MC4yNzc2IDM4OS41MjkxLDEzMi45OTc2IiBmaWxsPSJub25lIiBpZD0iZXMtdG8tZXYzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzOTUuMjEsMTMxLjA2NjksMzg1LjQwMTUsMTMwLjE3NTgsMzkwLjQ3NTksMTMyLjY3NTgsMzg3Ljk3NTksMTM3Ljc1MDIsMzk1LjIxLDEzMS4wNjY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PC9nPjw/cGxhbnR1bWwtc3JjIFBQOUZJbTkxNkNSbHlvYlV6Z3BXN3htODFnS1RrV1JUV1hYdEhybElzVFdUbEtJN3RUNkFFYlgyYU0xdVlJV1kydUIySkZxbXVzZi1Zc1FxXzNrN3VQcnR2dGR1bFN5aUNyY0VtQjNVeTlpRHVKTzdOdlRvN3hkTm1Zc1g3Q2FtTzFST1BkUVZXTTdRSDZVY0hINHduRmUxcFhCR2FqaXhBR3NFYTg0UEpjRDdUaDJrTW1OQTcxM3lIRjFsbU15NFZ6TzBFdzNSMUdESFluNThNdW5QVVIwb2F2dmY5Q0FYSzNXMDVFVDlHWGpNa2dGSkFvcTBRUHAzTDJVOU00V2s5RGotX0w3MjNTeV8xa0tCTUdZdFhtV3JHN2NZdXBhZ3VUcUJOWEZ5TlYwcHVOS0tYbFVmWmp4UjhZbWY0aWhzNzZSUFA4bjg3OEpLYTlYY1BJWlFmbGVDdUpZaUp1UEFzV0dwT2twSUFWNF9PY1dZQnVQTnZQNHVSNG5rUkw1VDZaWkEwRVVMZHBBSHdxeVJNVEw2ZnplS01UUjZ2Z0hIWDhXM21VM1E2NjVRSGNRYmxCNEtsUG5MazNOWGplSnhlQzlTb0FwUXh6dHZCeFVldHN1RklYTnJOekl5ZVRVUWZVekxfVXdKTi1QLXZWTTdULVFVdUhTMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<p><strong>2. Append-Only（追記専用）</strong></p>
<p>イベントは一度記録されたら変更・削除されません。新しいイベントを追加することで状態を変更します。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ❌ 悪い例: 既存レコードを更新</span>
<span class="n">UPDATE</span><span class="w"> </span><span class="n">accounts</span><span class="w"> </span><span class="n">SET</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50000</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1001</span><span class="p">;</span>

<span class="c1">// ✅ 良い例: イベントを追加</span>
<span class="n">INSERT</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="nf">event_store</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">aggregate_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_type</span><span class="p">,</span><span class="w"> </span><span class="n">event_data</span>
<span class="p">)</span><span class="w"> </span><span class="n">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="err">&#39;</span><span class="mi">1001</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="err">&#39;</span><span class="n">BalanceDecreased</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="err">&#39;</span><span class="p">{</span><span class="s">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;支払い&quot;</span><span class="p">}</span><span class="err">&#39;</span>
<span class="p">);</span>
</code></pre></div>
<p><strong>3. イベント再生（Event Replay）</strong></p>
<p>保存されたイベントを順番に再生することで、任意の時点の状態を復元できます。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AccountAggregate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uncommittedEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// イベント再生</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">AccountAggregate</span><span class="w"> </span><span class="nf">replay</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AccountAggregate</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AccountAggregate</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">account</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">account</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// イベント適用</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AccountCreatedEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getAccountId</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getInitialBalance</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">BalanceIncreasedEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">balance</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getAmount</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">BalanceDecreasedEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">balance</span><span class="p">.</span><span class="na">subtract</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getAmount</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="crud">CRUD との違い<a class="headerlink" href="#crud" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>CRUD アプローチ</th>
<th>イベントソーシング</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>保存対象</strong></td>
<td>現在の状態</td>
<td>変更イベントの履歴</td>
</tr>
<tr>
<td><strong>データベース操作</strong></td>
<td>UPDATE/DELETE で上書き</td>
<td>INSERT のみ（Append-Only）</td>
</tr>
<tr>
<td><strong>履歴の扱い</strong></td>
<td>別テーブルで管理（監査ログ）</td>
<td>イベントストア自体が履歴</td>
</tr>
<tr>
<td><strong>状態の復元</strong></td>
<td>データベースから直接読み取り</td>
<td>イベント再生で復元</td>
</tr>
<tr>
<td><strong>時間軸</strong></td>
<td>現在の状態のみ</td>
<td>任意の時点の状態を復元可能</td>
</tr>
<tr>
<td><strong>変更の理由</strong></td>
<td>記録されない（または別テーブル）</td>
<td>イベントに含まれる</td>
</tr>
<tr>
<td><strong>整合性</strong></td>
<td>トランザクションで保証</td>
<td>イベントの順序で保証</td>
</tr>
<tr>
<td><strong>複雑さ</strong></td>
<td>シンプル</td>
<td>高い（イベント設計、再生ロジック）</td>
</tr>
</tbody>
</table>
<h3 id="_2">イベントソーシングの利点<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><strong>1. 完全な監査証跡</strong></p>
<p>すべての変更がイベントとして記録されるため、完全な監査証跡が自動的に得られます。財務会計システムでは法的要件を満たすために不可欠です。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// イベントストアから特定期間のすべての操作を取得</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">auditTrail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStore</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;journal-1001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">59</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// 誰が、いつ、何をしたかが完全に記録されている</span>
<span class="n">auditTrail</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;%s: %s by %s%n&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">getTimestamp</span><span class="p">(),</span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">getEventType</span><span class="p">(),</span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">getUserId</span><span class="p">()</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>2. タイムトラベル（時間軸の復元）</strong></p>
<p>任意の時点の状態を復元できるため、「2024年1月1日時点の残高」などを正確に再現できます。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 2024年1月1日時点の残高を復元</span>
<span class="n">LocalDateTime</span><span class="w"> </span><span class="n">pointInTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eventsUntil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStore</span><span class="p">.</span><span class="na">getEventsUntil</span><span class="p">(</span><span class="s">&quot;account-1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pointInTime</span><span class="p">);</span>
<span class="n">AccountAggregate</span><span class="w"> </span><span class="n">accountAtPast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AccountAggregate</span><span class="p">.</span><span class="na">replay</span><span class="p">(</span><span class="n">eventsUntil</span><span class="p">);</span>

<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;2024/01/01時点の残高: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">accountAtPast</span><span class="p">.</span><span class="na">getBalance</span><span class="p">());</span>
</code></pre></div>
<p><strong>3. デバッグとトラブルシューティング</strong></p>
<p>バグや不正な操作が発生した場合、イベントを再生することで問題の原因を特定できます。</p>
<p><strong>4. 柔軟なビジネスロジック</strong></p>
<p>新しいビジネス要件が発生した場合、過去のイベントを再生して新しいモデルを構築できます。</p>
<h3 id="_3">イベントソーシングの課題<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>課題</th>
<th>説明</th>
<th>解決策</th>
</tr>
</thead>
<tbody>
<tr>
<td>複雑性の増加</td>
<td>CRUD より実装が複雑</td>
<td>段階的な導入、チーム教育</td>
</tr>
<tr>
<td>学習曲線</td>
<td>チーム全体が理解必要</td>
<td>ドキュメント、ペアプログラミング</td>
</tr>
<tr>
<td>パフォーマンス</td>
<td>大量イベントの再生が遅い</td>
<td>スナップショット（7.5節）</td>
</tr>
<tr>
<td>イベント定義変更</td>
<td>過去との互換性維持が必要</td>
<td>イベントバージョニング</td>
</tr>
<tr>
<td>削除の扱い</td>
<td>GDPR 対応が難しい</td>
<td>暗号化キー削除、論理削除</td>
</tr>
</tbody>
</table>
<h3 id="_4">適用ケース<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p><strong>適している場合</strong>:
- ✅ 監査証跡が重要（財務会計、医療、金融）
- ✅ 履歴の分析が必要（行動分析、レポート）
- ✅ ドメインが複雑（DDD と組み合わせ）
- ✅ イベント駆動アーキテクチャを採用</p>
<p><strong>適していない場合</strong>:
- ❌ シンプルな CRUD で十分
- ❌ チームの経験が不足
- ❌ パフォーマンスが最優先
- ❌ イベント再生の必要性が低い</p>
<hr />
<h2 id="312">31.2 イベントストアの設計<a class="headerlink" href="#312" title="Permanent link">&para;</a></h2>
<h3 id="_5">イベントストアの要件<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>イベントストアは、イベントソーシングの中核となるデータベーステーブルです。以下の要件を満たす必要があります：</p>
<ol>
<li><strong>Append-Only（追記専用）</strong>: 一度保存されたイベントは変更・削除されない</li>
<li><strong>順序保証</strong>: イベントの発生順序が正確に記録される</li>
<li><strong>高速な読み取り</strong>: 特定の Aggregate のイベントを高速に取得できる</li>
<li><strong>トランザクション保証</strong>: 複数のイベントをアトミックに保存できる</li>
<li><strong>スケーラビリティ</strong>: 大量のイベントを効率的に保存・検索できる</li>
</ol>
<h3 id="postgresql">テーブル設計（PostgreSQL）<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- イベントストアテーブル</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">event_store</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="c1">-- 主キー（シーケンス番号）</span>
<span class="w">    </span><span class="n">event_id</span><span class="w"> </span><span class="n">BIGSERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>

<span class="w">    </span><span class="c1">-- Aggregate 識別子</span>
<span class="w">    </span><span class="n">aggregate_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">aggregate_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>

<span class="w">    </span><span class="c1">-- イベントメタデータ</span>
<span class="w">    </span><span class="n">event_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">event_version</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>

<span class="w">    </span><span class="c1">-- イベントデータ（JSONB形式）</span>
<span class="w">    </span><span class="n">event_data</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>

<span class="w">    </span><span class="c1">-- メタデータ</span>
<span class="w">    </span><span class="n">occurred_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">correlation_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">causation_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>

<span class="w">    </span><span class="c1">-- 楽観的ロック（同時実行制御）</span>
<span class="w">    </span><span class="n">sequence_number</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>

<span class="w">    </span><span class="c1">-- 一意性制約（同一 Aggregate の sequence_number は一意）</span>
<span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">uk_aggregate_sequence</span>
<span class="w">        </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">aggregate_id</span><span class="p">,</span><span class="w"> </span><span class="n">sequence_number</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- インデックス設計</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_event_store_aggregate_id</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">event_store</span><span class="p">(</span><span class="n">aggregate_id</span><span class="p">,</span><span class="w"> </span><span class="n">sequence_number</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_event_store_event_type</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">event_store</span><span class="p">(</span><span class="n">event_type</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_event_store_occurred_at</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">event_store</span><span class="p">(</span><span class="n">occurred_at</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_event_store_correlation_id</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">event_store</span><span class="p">(</span><span class="n">correlation_id</span><span class="p">);</span>

<span class="c1">-- JSONB用のGINインデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_event_store_event_data</span>
<span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">event_store</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIN</span><span class="w"> </span><span class="p">(</span><span class="n">event_data</span><span class="p">);</span>
</code></pre></div>
<h3 id="_6">スキーマの詳細説明<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>カラム</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event_id</code></td>
<td>グローバルな順序を保証するシーケンス番号</td>
</tr>
<tr>
<td><code>aggregate_id</code></td>
<td>Aggregate のユニーク識別子（例: "journal-1001"）</td>
</tr>
<tr>
<td><code>aggregate_type</code></td>
<td>Aggregate の型（例: "JournalEntry"）</td>
</tr>
<tr>
<td><code>event_type</code></td>
<td>イベントの型（例: "JournalCreatedEvent"）</td>
</tr>
<tr>
<td><code>event_version</code></td>
<td>イベント定義のバージョン（スキーマ進化に対応）</td>
</tr>
<tr>
<td><code>event_data</code></td>
<td>イベントのペイロード（JSONB形式）</td>
</tr>
<tr>
<td><code>occurred_at</code></td>
<td>イベントが発生した日時</td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>イベントを発生させたユーザー ID</td>
</tr>
<tr>
<td><code>correlation_id</code></td>
<td>関連する一連のイベントをグループ化</td>
</tr>
<tr>
<td><code>causation_id</code></td>
<td>因果関係のあるイベント ID</td>
</tr>
<tr>
<td><code>sequence_number</code></td>
<td>Aggregate 内でのイベントの順序番号</td>
</tr>
</tbody>
</table>
<h3 id="correlation_id-causation_id">correlation_id と causation_id<a class="headerlink" href="#correlation_id-causation_id" title="Permanent link">&para;</a></h3>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMT8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IlNFUVVFTkNFIiBoZWlnaHQ9IjMzN3B4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6ODA4cHg7aGVpZ2h0OjMzN3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDgwOCAzMzciIHdpZHRoPSI4MDhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPmNvcnJlbGF0aW9uX2lkICYjMTIzOTI7IGNhdXNhdGlvbl9pZDwvdGl0bGU+PGRlZnMvPjxnPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMzAuNTAwOSIgeD0iMjg5Ljk5NzQiIHk9IjI3Ljk5NTEiPmNvcnJlbGF0aW9uX2lkICYjMTIzOTI7IGNhdXNhdGlvbl9pZDwvdGV4dD48ZyBjbGFzcz0icGFydGljaXBhbnQtbGlmZWxpbmUiIGRhdGEtZW50aXR5LXVpZD0icGFydDEiIGRhdGEtcXVhbGlmaWVkLW5hbWU9InVzZXIiIGlkPSJwYXJ0MS1saWZlbGluZSI+PGc+PHRpdGxlPi4uLi48L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxNTQuNTMxMyIgd2lkdGg9IjgiIHg9IjM1Ljk5OTkiIHk9IjEwNC41OTM4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7c3Ryb2tlLWRhc2hhcnJheTo1LDU7IiB4MT0iMzkiIHgyPSIzOSIgeTE9IjEwNC41OTM4IiB5Mj0iMjU5LjEyNSIvPjwvZz48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50LWxpZmVsaW5lIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJzeXMiIGlkPSJwYXJ0Mi1saWZlbGluZSI+PGc+PHRpdGxlPi4uLi48L3RpdGxlPjxyZWN0IGZpbGw9IiMwMDAwMDAiIGZpbGwtb3BhY2l0eT0iMC4wMDAwMCIgaGVpZ2h0PSIxNTQuNTMxMyIgd2lkdGg9IjgiIHg9IjI4Ni45Nzk0IiB5PSIxMDQuNTkzOCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41O3N0cm9rZS1kYXNoYXJyYXk6NSw1OyIgeDE9IjI4OS45Nzk2IiB4Mj0iMjg5Ljk3OTYiIHkxPSIxMDQuNTkzOCIgeTI9IjI1OS4xMjUiLz48L2c+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudC1saWZlbGluZSIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MyIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iZGIiIGlkPSJwYXJ0My1saWZlbGluZSI+PGc+PHRpdGxlPmV2ZW50X3N0b3JlPC90aXRsZT48cmVjdCBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9IjAuMDAwMDAiIGhlaWdodD0iMTU0LjUzMTMiIHdpZHRoPSI4IiB4PSI2ODAuNDk1NiIgeT0iMTA0LjU5MzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtZGFzaGFycmF5OjUsNTsiIHgxPSI2ODQuMTk5NyIgeDI9IjY4NC4xOTk3IiB5MT0iMTA0LjU5MzgiIHkyPSIyNTkuMTI1Ii8+PC9nPjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtaGVhZCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0idXNlciIgaWQ9InBhcnQxLWhlYWQiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjkuOTk5OCIgeD0iNSIgeT0iNzMuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEyIiB5PSI5My4yOTIiPiYjMTI1MTg7JiMxMjU0MDsmIzEyNDcwOyYjMTI1NDA7PC90ZXh0PjwvZz48ZyBjbGFzcz0icGFydGljaXBhbnQgcGFydGljaXBhbnQtdGFpbCIgZGF0YS1lbnRpdHktdWlkPSJwYXJ0MSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0idXNlciIgaWQ9InBhcnQxLXRhaWwiPjxyZWN0IGZpbGw9IiNFMkUyRjAiIGhlaWdodD0iMzAuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iNjkuOTk5OCIgeD0iNSIgeT0iMjU4LjEyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjEyIiB5PSIyNzguMTIwMSI+JiMxMjUxODsmIzEyNTQwOyYjMTI0NzA7JiMxMjU0MDs8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC1oZWFkIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJzeXMiIGlkPSJwYXJ0Mi1oZWFkIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY5Ljk5OTgiIHg9IjI1NS45Nzk2IiB5PSI3My4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjYyLjk3OTYiIHk9IjkzLjI5MiI+JiMxMjQ3MTsmIzEyNDczOyYjMTI0ODY7JiMxMjUxMjs8L3RleHQ+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJzeXMiIGlkPSJwYXJ0Mi10YWlsIj48cmVjdCBmaWxsPSIjRTJFMkYwIiBoZWlnaHQ9IjMwLjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjY5Ljk5OTgiIHg9IjI1NS45Nzk2IiB5PSIyNTguMTI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iMjYyLjk3OTYiIHk9IjI3OC4xMjAxIj4mIzEyNDcxOyYjMTI0NzM7JiMxMjQ4NjsmIzEyNTEyOzwvdGV4dD48L2c+PGcgY2xhc3M9InBhcnRpY2lwYW50IHBhcnRpY2lwYW50LWhlYWQiIGRhdGEtZW50aXR5LXVpZD0icGFydDMiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImRiIiBpZD0icGFydDMtaGVhZCI+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuNTkxOCIgeD0iNjQwLjE5OTciIHk9IjEwMS4yOTIiPmV2ZW50X3N0b3JlPC90ZXh0PjxwYXRoIGQ9Ik02NjYuNDk1Niw1Mi4yOTY5IEM2NjYuNDk1Niw0Mi4yOTY5IDY4NC40OTU2LDQyLjI5NjkgNjg0LjQ5NTYsNDIuMjk2OSBDNjg0LjQ5NTYsNDIuMjk2OSA3MDIuNDk1Niw0Mi4yOTY5IDcwMi40OTU2LDUyLjI5NjkgTDcwMi40OTU2LDc4LjI5NjkgQzcwMi40OTU2LDg4LjI5NjkgNjg0LjQ5NTYsODguMjk2OSA2ODQuNDk1Niw4OC4yOTY5IEM2ODQuNDk1Niw4OC4yOTY5IDY2Ni40OTU2LDg4LjI5NjkgNjY2LjQ5NTYsNzguMjk2OSBMNjY2LjQ5NTYsNTIuMjk2OSIgZmlsbD0iI0UyRTJGMCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTY2Ni40OTU2LDUyLjI5NjkgQzY2Ni40OTU2LDYyLjI5NjkgNjg0LjQ5NTYsNjIuMjk2OSA2ODQuNDk1Niw2Mi4yOTY5IEM2ODQuNDk1Niw2Mi4yOTY5IDcwMi40OTU2LDYyLjI5NjkgNzAyLjQ5NTYsNTIuMjk2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PC9nPjxnIGNsYXNzPSJwYXJ0aWNpcGFudCBwYXJ0aWNpcGFudC10YWlsIiBkYXRhLWVudGl0eS11aWQ9InBhcnQzIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJkYiIgaWQ9InBhcnQzLXRhaWwiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgyLjU5MTgiIHg9IjY0MC4xOTk3IiB5PSIyNzEuMTIwMSI+ZXZlbnRfc3RvcmU8L3RleHQ+PHBhdGggZD0iTTY2Ni40OTU2LDI4NC40MjE5IEM2NjYuNDk1NiwyNzQuNDIxOSA2ODQuNDk1NiwyNzQuNDIxOSA2ODQuNDk1NiwyNzQuNDIxOSBDNjg0LjQ5NTYsMjc0LjQyMTkgNzAyLjQ5NTYsMjc0LjQyMTkgNzAyLjQ5NTYsMjg0LjQyMTkgTDcwMi40OTU2LDMxMC40MjE5IEM3MDIuNDk1NiwzMjAuNDIxOSA2ODQuNDk1NiwzMjAuNDIxOSA2ODQuNDk1NiwzMjAuNDIxOSBDNjg0LjQ5NTYsMzIwLjQyMTkgNjY2LjQ5NTYsMzIwLjQyMTkgNjY2LjQ5NTYsMzEwLjQyMTkgTDY2Ni40OTU2LDI4NC40MjE5IiBmaWxsPSIjRTJFMkYwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNjY2LjQ5NTYsMjg0LjQyMTkgQzY2Ni40OTU2LDI5NC40MjE5IDY4NC40OTU2LDI5NC40MjE5IDY4NC40OTU2LDI5NC40MjE5IEM2ODQuNDk1NiwyOTQuNDIxOSA3MDIuNDk1NiwyOTQuNDIxOSA3MDIuNDk1NiwyODQuNDIxOSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MSIgZGF0YS1lbnRpdHktMj0icGFydDIiIGlkPSJtc2cxIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjI3OC45Nzk0LDEzMS43MjY2LDI4OC45Nzk0LDEzNS43MjY2LDI3OC45Nzk0LDEzOS43MjY2LDI4Mi45Nzk0LDEzNS43MjY2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjM5Ljk5OTkiIHgyPSIyODQuOTc5NCIgeTE9IjEzNS43MjY2IiB5Mj0iMTM1LjcyNjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyMjYuOTc5NiIgeD0iNDYuOTk5OSIgeT0iMTMwLjY2MDYiPiYjMTI1MjI7JiMxMjQ2MzsmIzEyNDU2OyYjMTI0NzM7JiMxMjQ4ODsgKGNvcnJlbGF0aW9uX2lkPWFiYzEyMyk8L3RleHQ+PC9nPjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2cyIj48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY3Mi40OTU2LDE2My44NTk0LDY4Mi40OTU2LDE2Ny44NTk0LDY3Mi40OTU2LDE3MS44NTk0LDY3Ni40OTU2LDE2Ny44NTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI5MC45Nzk0IiB4Mj0iNjc4LjQ5NTYiIHkxPSIxNjcuODU5NCIgeTI9IjE2Ny44NTk0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzMxLjcwOTUiIHg9IjI5Ny45Nzk0IiB5PSIxNjIuNzkzNSI+RXZlbnQxIChjb3JyZWxhdGlvbl9pZD1hYmMxMjMsIGNhdXNhdGlvbl9pZD1udWxsKTwvdGV4dD48L2c+PHBhdGggZD0iTTY4OSwxNDguNzI2NiBMNjg5LDE3My43MjY2IEw4MDEsMTczLjcyNjYgTDgwMSwxNTguNzI2NiBMNzkxLDE0OC43MjY2IEw2ODksMTQ4LjcyNjYiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03OTEsMTQ4LjcyNjYgTDc5MSwxNTguNzI2NiBMODAxLDE1OC43MjY2IEw3OTEsMTQ4LjcyNjYiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkxLjAwMDEiIHg9IjY5NSIgeT0iMTY1Ljc5MzUiPiYjMjYzNjg7JiMyMTAyMTsmIzEyMzk4OyYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2c0Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY3Mi40OTU2LDE5OC45OTIyLDY4Mi40OTU2LDIwMi45OTIyLDY3Mi40OTU2LDIwNi45OTIyLDY3Ni40OTU2LDIwMi45OTIyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgeDE9IjI5MC45Nzk0IiB4Mj0iNjc4LjQ5NTYiIHkxPSIyMDIuOTkyMiIgeTI9IjIwMi45OTIyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzY5LjUxNjEiIHg9IjI5Ny45Nzk0IiB5PSIxOTcuOTI2MyI+RXZlbnQyIChjb3JyZWxhdGlvbl9pZD1hYmMxMjMsIGNhdXNhdGlvbl9pZD1FdmVudDEuaWQpPC90ZXh0PjwvZz48cGF0aCBkPSJNNjg5LDE4My44NTk0IEw2ODksMjA4Ljg1OTQgTDc5NCwyMDguODU5NCBMNzk0LDE5My44NTk0IEw3ODQsMTgzLjg1OTQgTDY4OSwxODMuODU5NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTc4NCwxODMuODU5NCBMNzg0LDE5My44NTk0IEw3OTQsMTkzLjg1OTQgTDc4NCwxODMuODU5NCIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODQuNTEyNyIgeD0iNjk1IiB5PSIyMDAuOTI2MyI+RXZlbnQxJiMxMjM2NDsmIzIxNDA3OyYjMjIyNDA7PC90ZXh0PjxnIGNsYXNzPSJtZXNzYWdlIiBkYXRhLWVudGl0eS0xPSJwYXJ0MiIgZGF0YS1lbnRpdHktMj0icGFydDMiIGlkPSJtc2c2Ij48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjY3Mi40OTU2LDIzNC4xMjUsNjgyLjQ5NTYsMjM4LjEyNSw2NzIuNDk1NiwyNDIuMTI1LDY3Ni40OTU2LDIzOC4xMjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB4MT0iMjkwLjk3OTQiIHgyPSI2NzguNDk1NiIgeTE9IjIzOC4xMjUiIHkyPSIyMzguMTI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzY5LjUxNjEiIHg9IjI5Ny45Nzk0IiB5PSIyMzMuMDU5MSI+RXZlbnQzIChjb3JyZWxhdGlvbl9pZD1hYmMxMjMsIGNhdXNhdGlvbl9pZD1FdmVudDEuaWQpPC90ZXh0PjwvZz48cGF0aCBkPSJNNjg5LDIxOC45OTIyIEw2ODksMjQzLjk5MjIgTDc5NCwyNDMuOTkyMiBMNzk0LDIyOC45OTIyIEw3ODQsMjE4Ljk5MjIgTDY4OSwyMTguOTkyMiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTc4NCwyMTguOTkyMiBMNzg0LDIyOC45OTIyIEw3OTQsMjI4Ljk5MjIgTDc4NCwyMTguOTkyMiIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODQuNTEyNyIgeD0iNjk1IiB5PSIyMzYuMDU5MSI+RXZlbnQxJiMxMjM2NDsmIzIxNDA3OyYjMjIyNDA7PC90ZXh0Pjw/cGxhbnR1bWwtc3JjIGhPLW5JV0QxNDhSeFZPaFhBV0RISUQ4VG5DeGQyN0V0WW91U1VzNXRKaDNwVGE1SVlCc2VjNDhhTTlXWWEyM3VEaUZiRU45dDhTS1AxMGtSQU1RLS1VT1ZxZkdmSTdEaExPUWFTcEZINGhYU0c4ZzVFcEk0Y0E4YmRVZWY2ZUE4bXBrN1JfUmhrYVEwM1dnZHgwXzRSelhfU1JaWkM2eUhULUU0SEM4NGRPOThOSWozNHFVdkxVcks5YThxNFpXelJ5V09FN29tTng5Vmo5T1BkN0dKWlo1OTF5REhKdVlRUmZQYTRpRDU4bnR5V2xPeDN1ckRhTUt6T045SU9GTmI1U01tVlJ3alBZelNWaDlfdV8zOE9MTlZGVk9GXy1SVlBwZEppZGphdC1Sb2xkZnVoUHhjbl9oSFYtZnQ/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_7">イベントのバージョニング<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>イベント定義は時間とともに変化します。互換性を保つために <code>event_version</code> フィールドを使用します。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Version 1</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalCreatedEventV1</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="p">,</span>
<span class="w">    </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">entryDate</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lineItems</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getEventVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Version 2（新フィールド追加）</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">JournalCreatedEventV2</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="p">,</span>
<span class="w">    </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">entryDate</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lineItems</span><span class="p">,</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">fiscalYear</span><span class="w">  </span><span class="c1">// 新フィールド</span>
<span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getEventVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// V1からV2へのマイグレーション</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalCreatedEventV2</span><span class="w"> </span><span class="nf">fromV1</span><span class="p">(</span><span class="n">JournalCreatedEventV1</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalCreatedEventV2</span><span class="p">(</span>
<span class="w">            </span><span class="n">v1</span><span class="p">.</span><span class="na">journalId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">v1</span><span class="p">.</span><span class="na">entryDate</span><span class="p">(),</span>
<span class="w">            </span><span class="n">v1</span><span class="p">.</span><span class="na">description</span><span class="p">(),</span>
<span class="w">            </span><span class="n">v1</span><span class="p">.</span><span class="na">lineItems</span><span class="p">(),</span>
<span class="w">            </span><span class="n">deriveFiscalYear</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="na">entryDate</span><span class="p">())</span><span class="w">  </span><span class="c1">// 日付から推定</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="313">31.3 仕訳のイベントソーシング実装<a class="headerlink" href="#313" title="Permanent link">&para;</a></h2>
<h3 id="_8">ドメインイベントの定義<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/event/DomainEvent.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.domain.event</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">getAggregateId</span><span class="p">();</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">getEventType</span><span class="p">();</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getEventVersion</span><span class="p">();</span>
<span class="w">    </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="nf">getOccurredAt</span><span class="p">();</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="nf">getUserId</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>仕訳作成イベント</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/event/JournalEntryCreatedEvent.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.domain.event</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Builder</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Value</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Value</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryCreatedEvent</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">entryDate</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lineItems</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span>
<span class="w">    </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">occurredAt</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAggregateId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getEventType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;JournalEntryCreatedEvent&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getEventVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Value</span>
<span class="w">    </span><span class="nd">@Builder</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LineItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>
<span class="w">        </span><span class="n">DebitCredit</span><span class="w"> </span><span class="n">debitCredit</span><span class="p">;</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">DebitCredit</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEBIT</span><span class="p">,</span><span class="w"> </span><span class="n">CREDIT</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>仕訳承認イベント</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/event/JournalEntryApprovedEvent.java</span>
<span class="nd">@Value</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryApprovedEvent</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">;</span>
<span class="w">    </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">occurredAt</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAggregateId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getEventType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;JournalEntryApprovedEvent&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getEventVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>仕訳取消イベント</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/event/JournalEntryCancelledEvent.java</span>
<span class="nd">@Value</span>
<span class="nd">@Builder</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryCancelledEvent</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">;</span>
<span class="w">    </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">occurredAt</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAggregateId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getEventType</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;JournalEntryCancelledEvent&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getEventVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="aggregate">Aggregate パターンの実装<a class="headerlink" href="#aggregate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/aggregate/JournalEntryAggregate.java</span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.example.accounting.domain.aggregate</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">com.example.accounting.domain.event.*</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Getter</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span>

<span class="nd">@Getter</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryAggregate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">entryDate</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lineItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">cancelled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 未コミットイベント（まだイベントストアに保存されていない）</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">uncommittedEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// バージョン（楽観的ロック用）</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// イベント再生（Event Replay）</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="nf">replay</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">version</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">aggregate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// コマンド: 仕訳を作成</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">entryDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">,</span>
<span class="w">            </span><span class="n">List</span><span class="o">&lt;</span><span class="n">LineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lineItems</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// ビジネスルール検証: 貸借一致</span>
<span class="w">        </span><span class="n">validateBalance</span><span class="p">(</span><span class="n">lineItems</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// イベント発行</span>
<span class="w">        </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">entryDate</span><span class="p">(</span><span class="n">entryDate</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">lineItems</span><span class="p">(</span><span class="n">toEventLineItems</span><span class="p">(</span><span class="n">lineItems</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">occurredAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">();</span>
<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">uncommittedEvents</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">aggregate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// コマンド: 仕訳を承認</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">approve</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">approvedBy</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">approvalComment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cancelled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;取消済みの仕訳は承認できません&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;すでに承認済みです&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(</span><span class="n">approvedBy</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">approvalComment</span><span class="p">(</span><span class="n">approvalComment</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">occurredAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="n">approvedBy</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">        </span><span class="n">uncommittedEvents</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// コマンド: 仕訳を取消</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cancelled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalStateException</span><span class="p">(</span><span class="s">&quot;すでに取消済みです&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reason</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">occurredAt</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">        </span><span class="n">uncommittedEvents</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// イベント適用（Apply）</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">entryDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getEntryDate</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getDescription</span><span class="p">();</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">lineItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fromEventLineItems</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getLineItems</span><span class="p">());</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">cancelled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 未コミットイベントをクリア</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">markEventsAsCommitted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uncommittedEvents</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ビジネスルール: 貸借一致の検証</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">validateBalance</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">LineItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lineItems</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lineItems</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">lineItems</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;仕訳明細が必要です&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">debitTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineItems</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getDebitCredit</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DebitCredit</span><span class="p">.</span><span class="na">DEBIT</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">LineItem</span><span class="p">::</span><span class="n">getAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>

<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">creditTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lineItems</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="na">getDebitCredit</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DebitCredit</span><span class="p">.</span><span class="na">CREDIT</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">LineItem</span><span class="p">::</span><span class="n">getAmount</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">reduce</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">::</span><span class="n">add</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">debitTotal</span><span class="p">.</span><span class="na">compareTo</span><span class="p">(</span><span class="n">creditTotal</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;借方合計と貸方合計が一致しません: 借方=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">debitTotal</span><span class="w"> </span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;, 貸方=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">creditTotal</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ドメインモデル</span>
<span class="w">    </span><span class="nd">@Getter</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LineItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DebitCredit</span><span class="w"> </span><span class="n">debitCredit</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">LineItem</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">accountCode</span><span class="p">,</span><span class="w"> </span><span class="n">DebitCredit</span><span class="w"> </span><span class="n">debitCredit</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">accountCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountCode</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">debitCredit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">debitCredit</span><span class="p">;</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">DebitCredit</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DEBIT</span><span class="p">,</span><span class="w"> </span><span class="n">CREDIT</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">JournalEntryStatus</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">DRAFT</span><span class="p">,</span><span class="w"> </span><span class="n">APPROVED</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_9">イベントストアリポジトリ<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/repository/EventStoreRepository.java</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">EventStoreRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// イベントを保存</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedVersion</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Aggregate のすべてのイベントを取得</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getEvents</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 特定時点までのイベントを取得</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getEventsUntil</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">pointInTime</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Aggregate の現在のバージョンを取得</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getCurrentVersion</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// infrastructure/persistence/EventStoreRepositoryImpl.java</span>
<span class="nd">@Repository</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">EventStoreRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">EventStoreRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">EventStoreMapper</span><span class="w"> </span><span class="n">eventStoreMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCurrentVersion</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentVersion</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">expectedVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentModificationException</span><span class="p">(</span>
<span class="w">                </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Expected version %d but was %d&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">expectedVersion</span><span class="p">,</span><span class="w"> </span><span class="n">currentVersion</span><span class="p">)</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">sequenceNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">eventData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toJson</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>

<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">eventStoreMapper</span><span class="p">.</span><span class="na">insertEvent</span><span class="p">(</span>
<span class="w">                    </span><span class="n">aggregateId</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;JournalEntry&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="n">event</span><span class="p">.</span><span class="na">getEventType</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">event</span><span class="p">.</span><span class="na">getEventVersion</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">eventData</span><span class="p">,</span>
<span class="w">                    </span><span class="n">event</span><span class="p">.</span><span class="na">getOccurredAt</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">event</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span>
<span class="w">                    </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// correlation_id</span>
<span class="w">                    </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// causation_id</span>
<span class="w">                    </span><span class="n">sequenceNumber</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">                </span><span class="n">sequenceNumber</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DuplicateKeyException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentModificationException</span><span class="p">(</span>
<span class="w">                    </span><span class="s">&quot;Concurrent modification detected for aggregate: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">e</span>
<span class="w">                </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getEvents</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">EventStoreEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">eventStoreMapper</span><span class="p">.</span><span class="na">selectEventsByAggregateId</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">toDomainEvent</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getEventsUntil</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">pointInTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">EventStoreEntity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entities</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">eventStoreMapper</span><span class="p">.</span><span class="na">selectEventsByAggregateIdUntil</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">pointInTime</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entities</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">toDomainEvent</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getCurrentVersion</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">maxSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreMapper</span><span class="p">.</span><span class="na">selectMaxSequenceNumber</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">maxSequence</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">maxSequence</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="nf">toDomainEvent</span><span class="p">(</span><span class="n">EventStoreEntity</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getEventType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;JournalEntryCreatedEvent&quot;</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getEventData</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">JournalEntryCreatedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;JournalEntryApprovedEvent&quot;</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getEventData</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">JournalEntryApprovedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;JournalEntryCancelledEvent&quot;</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="na">getEventData</span><span class="p">(),</span>
<span class="w">                        </span><span class="n">JournalEntryCancelledEvent</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">                </span><span class="k">default</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span>
<span class="w">                        </span><span class="s">&quot;Unknown event type: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="na">getEventType</span><span class="p">());</span>
<span class="w">            </span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Failed to deserialize event&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="314-cqrs">31.4 CQRS パターン<a class="headerlink" href="#314-cqrs" title="Permanent link">&para;</a></h2>
<h3 id="cqrs">CQRS とは<a class="headerlink" href="#cqrs" title="Permanent link">&para;</a></h3>
<p>CQRS（Command Query Responsibility Segregation）は、データの「書き込み（Command）」と「読み取り（Query）」を分離するアーキテクチャパターンです。イベントソーシングと組み合わせることで、高いスケーラビリティと柔軟性を実現できます。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMT8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjUzNnB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6ODUzcHg7aGVpZ2h0OjUzNnB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDg1MyA1MzYiIHdpZHRoPSI4NTNweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPkNRUlMgJiMxMjQ1MDsmIzEyNTQwOyYjMTI0NjE7JiMxMjQ4NjsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDUuOTEyNyIgeD0iMzQ2LjYwODciIHk9IjIyLjk5NTEiPkNRUlMgJiMxMjQ1MDsmIzEyNTQwOyYjMTI0NjE7JiMxMjQ4NjsmIzEyNDYzOyYjMTI0ODE7JiMxMjUxNTs8L3RleHQ+PC9nPjwhLS1jbHVzdGVyIGNvbW1hbmQtLT48ZyBjbGFzcz0iY2x1c3RlciIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iY29tbWFuZCIgZGF0YS1zb3VyY2UtbGluZT0iNiIgaWQ9ImVudDAwMDMiPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMTgwIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7IiB3aWR0aD0iMzc2LjM5IiB4PSIyMTkiIHk9IjI3MC4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNy43NzY0IiB4PSIzNDguMzA2OCIgeT0iMjg1LjI5MiI+Q29tbWFuZCBTaWRlPC90ZXh0PjwvZz48IS0tY2x1c3RlciBxdWVyeS0tPjxnIGNsYXNzPSJjbHVzdGVyIiBkYXRhLXF1YWxpZmllZC1uYW1lPSJxdWVyeSIgZGF0YS1zb3VyY2UtbGluZT0iMTIiIGlkPSJlbnQwMDA3Ij48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjE4MCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIgd2lkdGg9IjM4NC45MyIgeD0iNDYyLjIiIHk9IjQ0LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYuNjY2IiB4PSI2MTEuMzMyIiB5PSI1OS4yOTIiPlF1ZXJ5IFNpZGU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgPz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImNvbW1hbmQuLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iNyIgaWQ9ImVudDAwMDQiPjxlbGxpcHNlIGN4PSIyODUuNTk3OCIgY3k9IjM5Mi4zMDA1IiBmaWxsPSIjRjFGMUYxIiByeD0iNDIuNTk3OCIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI1Ny41OTc5IiB5PSIzOTYuOTQ4OSI+JiMyMDE4MTsmIzM1Mzc5OyYjMjAzMTY7JiMyNTEwNDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgPz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImNvbW1hbmQuLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iOCIgaWQ9ImVudDAwMDUiPjxlbGxpcHNlIGN4PSIyODUuNTk3OCIgY3k9IjMyOC4zMDA1IiBmaWxsPSIjRjFGMUYxIiByeD0iNDIuNTk3OCIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjI1Ny41OTc5IiB5PSIzMzIuOTQ4OSI+JiMyMDE4MTsmIzM1Mzc5OyYjMjUyMTU7JiMzNTQ2OTs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgPz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9ImNvbW1hbmQuLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iOSIgaWQ9ImVudDAwMDYiPjxlbGxpcHNlIGN4PSI1MjguNzg3OCIgY3k9IjM5Mi4zMDA1IiBmaWxsPSIjRjFGMUYxIiByeD0iNDIuNTk3OCIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9IjUwMC43ODc5IiB5PSIzOTYuOTQ4OSI+JiMyMDE4MTsmIzM1Mzc5OyYjMjE0NjI7JiMyODA0MDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgPz8/Py0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9InF1ZXJ5Li4uLi4iIGRhdGEtc291cmNlLWxpbmU9IjEzIiBpZD0iZW50MDAwOCI+PGVsbGlwc2UgY3g9IjUyOC43ODc4IiBjeT0iMTY2LjMwMDUiIGZpbGw9IiNGMUYxRjEiIHJ4PSI0Mi41OTc4IiByeT0iMTQuNTIzNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTUuOTk5OCIgeD0iNTAwLjc4NzkiIHk9IjE3MC45NDg5Ij4mIzIwMTgxOyYjMzUzNzk7JiMxOTk2ODsmIzM1MjM5OzwvdGV4dD48L2c+PCEtLWVudGl0eSA/Pz8/LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0icXVlcnkuLi4uLiIgZGF0YS1zb3VyY2UtbGluZT0iMTQiIGlkPSJlbnQwMDA5Ij48ZWxsaXBzZSBjeD0iNTI4Ljc4NzgiIGN5PSIxMDIuMzAwNSIgZmlsbD0iI0YxRjFGMSIgcng9IjQyLjU5NzgiIHJ5PSIxNC41MjM2IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1NS45OTk4IiB4PSI1MDAuNzg3OSIgeT0iMTA2Ljk0ODkiPiYjMjc1MzE7JiMzOTY0MDsmIzI5MDMxOyYjMjAyNTA7PC90ZXh0PjwvZz48IS0tZW50aXR5ID8/Pz8tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJxdWVyeS4uLi4uIiBkYXRhLXNvdXJjZS1saW5lPSIxNSIgaWQ9ImVudDAwMTAiPjxlbGxpcHNlIGN4PSI3ODAuNTM3OCIgY3k9IjE2Ni4zMDA1IiBmaWxsPSIjRjFGMUYxIiByeD0iNDIuNTk3OCIgcnk9IjE0LjUyMzYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjU1Ljk5OTgiIHg9Ijc1Mi41Mzc5IiB5PSIxNzAuOTQ4OSI+JiMyMDgwMzsmIzI0MTE1OyYjMjkwMzE7JiMyMDI1MDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgY2xpZW50LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iY2xpZW50IiBkYXRhLXNvdXJjZS1saW5lPSI0IiBpZD0iZW50MDAwMiI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDMuOTk5NiIgeD0iNyIgeT0iMzA4LjE0NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4My45OTk2IiB4PSIxNyIgeT0iMzMxLjE0MiI+JiMxMjQ2MzsmIzEyNTIxOyYjMTI0NTI7JiMxMjQ1MDsmIzEyNTMxOyYjMTI0ODg7PC90ZXh0PjwvZz48IS0tZW50aXR5IGVzLS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iZXMiIGRhdGEtc291cmNlLWxpbmU9IjE4IiBpZD0iZW50MDAxMSI+PHBhdGggZD0iTTQ3Ny44Niw0ODQuNjQ2OSBDNDc3Ljg2LDQ3NC42NDY5IDUyOC43OTM2LDQ3NC42NDY5IDUyOC43OTM2LDQ3NC42NDY5IEM1MjguNzkzNiw0NzQuNjQ2OSA1NzkuNzI3Miw0NzQuNjQ2OSA1NzkuNzI3Miw0ODQuNjQ2OSBMNTc5LjcyNzIsNTA5Ljk0MzcgQzU3OS43MjcyLDUxOS45NDM3IDUyOC43OTM2LDUxOS45NDM3IDUyOC43OTM2LDUxOS45NDM3IEM1MjguNzkzNiw1MTkuOTQzNyA0NzcuODYsNTE5Ljk0MzcgNDc3Ljg2LDUwOS45NDM3IEw0NzcuODYsNDg0LjY0NjkiIGZpbGw9IiNGMUYxRjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik00NzcuODYsNDg0LjY0NjkgQzQ3Ny44Niw0OTQuNjQ2OSA1MjguNzkzNiw0OTQuNjQ2OSA1MjguNzkzNiw0OTQuNjQ2OSBDNTI4Ljc5MzYsNDk0LjY0NjkgNTc5LjcyNzIsNDk0LjY0NjkgNTc5LjcyNzIsNDg0LjY0NjkiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxLjg2NzIiIHg9IjQ4Ny44NiIgeT0iNTExLjY0MiI+RXZlbnQgU3RvcmU8L3RleHQ+PC9nPjwhLS1lbnRpdHkgcm0tLT48ZyBjbGFzcz0iZW50aXR5IiBkYXRhLXF1YWxpZmllZC1uYW1lPSJybSIgZGF0YS1zb3VyY2UtbGluZT0iMTkiIGlkPSJlbnQwMDEyIj48cGF0aCBkPSJNNzI5LjM5LDM0NS42NDY5IEM3MjkuMzksMzM1LjY0NjkgNzgwLjUzNTUsMzM1LjY0NjkgNzgwLjUzNTUsMzM1LjY0NjkgQzc4MC41MzU1LDMzNS42NDY5IDgzMS42ODEsMzM1LjY0NjkgODMxLjY4MSwzNDUuNjQ2OSBMODMxLjY4MSwzNzAuOTQzNyBDODMxLjY4MSwzODAuOTQzNyA3ODAuNTM1NSwzODAuOTQzNyA3ODAuNTM1NSwzODAuOTQzNyBDNzgwLjUzNTUsMzgwLjk0MzcgNzI5LjM5LDM4MC45NDM3IDcyOS4zOSwzNzAuOTQzNyBMNzI5LjM5LDM0NS42NDY5IiBmaWxsPSIjRjFGMUYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cGF0aCBkPSJNNzI5LjM5LDM0NS42NDY5IEM3MjkuMzksMzU1LjY0NjkgNzgwLjUzNTUsMzU1LjY0NjkgNzgwLjUzNTUsMzU1LjY0NjkgQzc4MC41MzU1LDM1NS42NDY5IDgzMS42ODEsMzU1LjY0NjkgODMxLjY4MSwzNDUuNjQ2OSIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODIuMjkxIiB4PSI3MzkuMzkiIHk9IjM3Mi42NDIiPlJlYWQgTW9kZWw8L3RleHQ+PC9nPjwhLS1saW5rIGNsaWVudCB0byBjb21tYW5kLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMDIiIGRhdGEtZW50aXR5LTI9ImVudDAwMDMiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyMSIgaWQ9ImxuazEzIj48cGF0aCBkPSJNODEuNzUsMzQ0Ljg2NjkgQzEwOC41NSwzNjYuNzg2OSAxNTYuMjgsNDAyLjg1NjkgMjAzLDQyMy4yOTY5IEMyMDcuMTMxMyw0MjUuMTA0NCAyMTEuNDU4NCw0MjYuNzUyOCAyMTUuODczNSw0MjguMjU0MiBDMjE2LjQyNTQsNDI4LjQ0MTkgMjE2Ljk3ODcsNDI4LjYyNzIgMjE3LjUzMzEsNDI4LjgxMDMgQzIxNy44MTAzLDQyOC45MDE5IDIxOC4wODc4LDQyOC45OTI5IDIxOC4zNjU2LDQyOS4wODMzIEMyMTguNTA0NSw0MjkuMTI4NSAyMTIuOTM0Miw0MjcuMzI4NSAyMTMuMDczMiw0MjcuMzczNCIgZmlsbD0ibm9uZSIgaWQ9ImNsaWVudC10by1jb21tYW5kIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTguNzgyNCw0MjkuMjE4NSwyMTEuNDQ4Niw0MjIuNjQ0NywyMTQuMDI0Nyw0MjcuNjgwOSwyMDguOTg4NSw0MzAuMjU3LDIxOC43ODI0LDQyOS4yMTg1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIuMDAwMSIgeD0iMTQyIiB5PSIzODQuODQzOCI+JiMxMjQ2NzsmIzEyNTEwOyYjMTI1MzE7JiMxMjQ4OTs8L3RleHQ+PC9nPjwhLS1saW5rIGNsaWVudCB0byBxdWVyeS0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAyIiBkYXRhLWVudGl0eS0yPSJlbnQwMDA3IiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjIiIGlkPSJsbmsxNCI+PHBhdGggZD0iTTExMS40LDMxNC4yMDY5IEMxNzEuNjg1LDMwMC4wMzE5IDI3NC42MzUsMjc1LjgyNDQgMzYzLjA4MTMsMjU1LjAyNjkgQzQwNy4zMDQ0LDI0NC42MjgxIDQ0Ny45MDE2LDIzNS4wODE5IDQ3Ny43MjY3LDIyOC4wNjg0IEM0ODEuNDU0OSwyMjcuMTkxOCA0ODUuMDE0NywyMjYuMzU0NyA0ODguMzkyMywyMjUuNTYwNCBDNDkwLjA4MSwyMjUuMTYzMyA0ODUuODgzNiwyMjYuMTUwMyA0ODcuNDc5NSwyMjUuNzc1MSIgZmlsbD0ibm9uZSIgaWQ9ImNsaWVudC10by1xdWVyeSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDkzLjMyMDIsMjI0LjQwMTYsNDgzLjY0MzUsMjIyLjU2OCw0ODguNDUyOSwyMjUuNTQ2MSw0ODUuNDc0OCwyMzAuMzU1Niw0OTMuMzIwMiwyMjQuNDAxNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjM5IiB4PSIyNjYuMSIgeT0iMjYwLjA1MzgiPiYjMTI0NjM7JiMxMjQ1NjsmIzEyNTIyOzwvdGV4dD48L2c+PCEtLWxpbmsgY29tbWFuZCB0byBlcy0tPjxnIGNsYXNzPSJsaW5rIiBkYXRhLWVudGl0eS0xPSJlbnQwMDAzIiBkYXRhLWVudGl0eS0yPSJlbnQwMDExIiBkYXRhLWxpbmstdHlwZT0iZGVwZW5kZW5jeSIgZGF0YS1zb3VyY2UtbGluZT0iMjQiIGlkPSJsbmsxNSI+PHBhdGggZD0iTTMyMi4yNjcyLDQ1MC40MzQzIEMzMjIuNzUwOCw0NTAuNTQ0NiAzMjMuMjM4Miw0NTAuNjU1NyAzMjMuNzI5MSw0NTAuNzY3NyBDMzI1LjY5MjksNDUxLjIxNTYgMzI3LjcxNDcsNDUxLjY3NjYgMzI5Ljc4OTQsNDUyLjE0OTcgQzMzOC4wODgxLDQ1NC4wNDIzIDM0Ny4yMzM4LDQ1Ni4xMjc4IDM1Ni45MDUsNDU4LjMzMzEgQzM5NS41OSw0NjcuMTU0NCA0MzYuODM1LDQ3Ni41NTg1IDQ3MS43OCw0ODQuNTIzNSIgZmlsbD0ibm9uZSIgaWQ9ImNvbW1hbmQtdG8tZXMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQ3Ny42Myw0ODUuODU2OSw0NjkuNzQ0LDQ3OS45NTY4LDQ3Mi43NTUsNDg0Ljc0NTcsNDY3Ljk2NjEsNDg3Ljc1NjgsNDc3LjYzLDQ4NS44NTY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzguMDAwMSIgeD0iMzU5LjIiIHk9IjQ1Ni4xNTM4Ij4mIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMjA0NDU7JiMyMzM4NDs8L3RleHQ+PC9nPjwhLS1saW5rIGVzIHRvIHJtLS0+PGcgY2xhc3M9ImxpbmsiIGRhdGEtZW50aXR5LTE9ImVudDAwMTEiIGRhdGEtZW50aXR5LTI9ImVudDAwMTIiIGRhdGEtbGluay10eXBlPSJkZXBlbmRlbmN5IiBkYXRhLXNvdXJjZS1saW5lPSIyNSIgaWQ9ImxuazE2Ij48cGF0aCBkPSJNNTcxLjMxLDQ3NC4xODY5IEM2MTcuNjQsNDQ4LjQwNjkgNjg2Ljg4NzYsNDA5Ljg2NTQgNzMzLjA4NzYsMzg0LjE0NTQiIGZpbGw9Im5vbmUiIGlkPSJlcy10by1ybSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzM4LjMzLDM4MS4yMjY5LDcyOC41MjA4LDM4Mi4xMDk3LDczMy45NjE0LDM4My42NTg5LDczMi40MTIxLDM4OS4wOTk1LDczOC4zMywzODEuMjI2OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc4LjAwMDEiIHg9IjYyMC4zOSIgeT0iMzk5LjMyMzgiPiYjMTI0NTI7JiMxMjUwNTsmIzEyNTMxOyYjMTI0ODg7JiMyMTUxNjsmIzI2Mzk5OzwvdGV4dD48L2c+PCEtLWxpbmsgcXVlcnkgdG8gcm0tLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwNyIgZGF0YS1lbnRpdHktMj0iZW50MDAxMiIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjI2IiBpZD0ibG5rMTciPjxwYXRoIGQ9Ik01NDQuMTg4NCwyMjQuNDg1MSBDNTQ3LjA1MjgsMjI2LjExMzcgNTUwLjI5MTgsMjI3Ljk1NTQgNTUzLjg1NjcsMjI5Ljk4MjMgQzU2OC4xMTY2LDIzOC4wOTAzIDU4Ny41OTE5LDI0OS4xNjM3IDYwOS4xNjYzLDI2MS40MzA2IEM2NTIuMzE1LDI4NS45NjQ0IDY5OC42NDQxLDMxMi4zMDY0IDczMy42NTQxLDMzMi4yMTE0IiBmaWxsPSJub25lIiBpZD0icXVlcnktdG8tcm0iIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjczOC44NywzMzUuMTc2OSw3MzMuMDIzMSwzMjcuMjUxMyw3MzQuNTIzNCwzMzIuNzA1Niw3MjkuMDY5MSwzMzQuMjA1OSw3MzguODcsMzM1LjE3NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI1Mi4wMDAxIiB4PSI2MzMuMzkiIHk9IjI2Ni40NzM4Ij4mIzM1NTAxOyYjMTI0MTU7JiMyMTQ2MjsmIzEyNDI2OzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgTlAzRElpRDA1OE50eW5IM0x0Ukg1dDNYZmhYcXFVTzluY1FpV1ZuV0NYTDQxOWtYYWxnM3RJWExnZThNTW9Fbll1MEtoRUhYUlhCWk1wWDlzaEhyRHNWRWtIX3Q3Z09tYlU5Z2hJdlhpOS0xcHkzc1c5LTFGRzdVMWx3MkxCaDdDM0VtZ0pKdDZQT0xhcFFPT2tXOGZHLVlEeUxxQUtrX1dKdEM0M3ZtZnVJOVhIa2dHZE1zYmdtUWNhUHE2S2tBSkZGQ19FQ09ST0hWRHlkTzN4eTdpVENoQnNKUzNIQnRnZjNIek10eXdQSkhvSGdycmdCY3FQOXZhQ2FiU05nUWw4dTQ4bHd1LTd0bF90SDZ1VW5Vb0FaM2V3Y19hODhlNHFQc1lJTTBzdVRZU0ltbm15bzlyNWVud3ZKOFVDVUdnUGZ2ZmVQR1ZZY2tMQlFBV3BQNWR3QTlud29GeGNlWU5vX3I5czJGV1JqWVZad0tzakpBbDI3bWt4cEJDN1k4bDN1SV93YmpRbF9pZzdTUDN2dkdKWXFJWVVqMUVuMXJXTnQtMW0wMD8+PC9nPjwvc3ZnPg==" class="uml" alt="uml diagram" title="" /></p>
<h3 id="command-side">Command Side の実装<a class="headerlink" href="#command-side" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// application/service/JournalEntryCommandService.java</span>
<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryCommandService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">EventStoreRepository</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicationEventPublisher</span><span class="w"> </span><span class="n">eventPublisher</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createJournalEntry</span><span class="p">(</span><span class="n">CreateJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>

<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">command</span><span class="p">.</span><span class="na">getEntryDate</span><span class="p">(),</span>
<span class="w">            </span><span class="n">command</span><span class="p">.</span><span class="na">getDescription</span><span class="p">(),</span>
<span class="w">            </span><span class="n">command</span><span class="p">.</span><span class="na">getLineItems</span><span class="p">(),</span>
<span class="w">            </span><span class="n">command</span><span class="p">.</span><span class="na">getUserId</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// イベントをイベントストアに保存</span>
<span class="w">        </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="p">,</span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">(),</span>
<span class="w">            </span><span class="mi">0</span><span class="w">  </span><span class="c1">// 新規作成なので expectedVersion = 0</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 読み取りモデル更新のためにイベントを発行</span>
<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">eventPublisher</span><span class="p">::</span><span class="n">publishEvent</span><span class="p">);</span>
<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">markEventsAsCommitted</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">approveJournalEntry</span><span class="p">(</span><span class="n">ApproveJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">events</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalNotFoundException</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">.</span><span class="na">replay</span><span class="p">(</span><span class="n">events</span><span class="p">);</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getVersion</span><span class="p">();</span>

<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">approve</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="na">getApprovedBy</span><span class="p">(),</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="na">getComment</span><span class="p">());</span>

<span class="w">        </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span>
<span class="w">            </span><span class="n">command</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">(),</span>
<span class="w">            </span><span class="n">currentVersion</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">().</span><span class="na">forEach</span><span class="p">(</span><span class="n">eventPublisher</span><span class="p">::</span><span class="n">publishEvent</span><span class="p">);</span>
<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">markEventsAsCommitted</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="query-side">Query Side（読み取りモデル）の実装<a class="headerlink" href="#query-side" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// infrastructure/projection/JournalEntryProjection.java</span>
<span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryProjection</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JournalEntryReadModelRepository</span><span class="w"> </span><span class="n">readModelRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@EventListener</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">JournalEntryReadModel</span><span class="w"> </span><span class="n">readModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryReadModel</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">entryDate</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getEntryDate</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getDescription</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="s">&quot;DRAFT&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">totalDebit</span><span class="p">(</span><span class="n">calculateTotalDebit</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getLineItems</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">totalCredit</span><span class="p">(</span><span class="n">calculateTotalCredit</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getLineItems</span><span class="p">()))</span>
<span class="w">            </span><span class="p">.</span><span class="na">createdAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOccurredAt</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">createdBy</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getUserId</span><span class="p">())</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">readModelRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">readModel</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventListener</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryApprovedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">readModelRepository</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="s">&quot;APPROVED&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getApprovedBy</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getOccurredAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@EventListener</span>
<span class="w">    </span><span class="nd">@Transactional</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">JournalEntryCancelledEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">readModelRepository</span><span class="p">.</span><span class="na">updateStatus</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getJournalEntryId</span><span class="p">(),</span>
<span class="w">            </span><span class="s">&quot;CANCELLED&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getUserId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getOccurredAt</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_10">読み取りモデルのテーブル<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- 読み取り専用モデル（非正規化）</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">journal_entry_read_model</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">journal_entry_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">entry_date</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_debit</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">total_credit</span><span class="w"> </span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">approved_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">approved_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">cancelled_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">cancelled_by</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 検索用インデックス</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_journal_read_entry_date</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_entry_read_model</span><span class="p">(</span><span class="n">entry_date</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_journal_read_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">journal_entry_read_model</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
</code></pre></div>
<h3 id="query-service">Query Service<a class="headerlink" href="#query-service" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// application/service/JournalEntryQueryService.java</span>
<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryQueryService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JournalEntryReadModelRepository</span><span class="w"> </span><span class="n">readModelRepository</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryReadModel</span><span class="w"> </span><span class="nf">getJournalEntry</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">journalEntryId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">readModelRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">orElseThrow</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalNotFoundException</span><span class="p">(</span><span class="n">journalEntryId</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryReadModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">searchJournalEntries</span><span class="p">(</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">fromDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">LocalDate</span><span class="w"> </span><span class="n">toDate</span><span class="p">,</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">readModelRepository</span><span class="p">.</span><span class="na">search</span><span class="p">(</span><span class="n">fromDate</span><span class="p">,</span><span class="w"> </span><span class="n">toDate</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">JournalEntryReadModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getPendingApprovals</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">readModelRepository</span><span class="p">.</span><span class="na">findByStatus</span><span class="p">(</span><span class="s">&quot;DRAFT&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="315">31.5 スナップショットと最適化<a class="headerlink" href="#315" title="Permanent link">&para;</a></h2>
<h3 id="_11">スナップショットの必要性<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>イベント数が増加すると、毎回すべてのイベントを再生するのはパフォーマンス上の問題になります。スナップショットを使用することで、この問題を解決できます。</p>
<p><img src="data:image/svg+xml;base64,PD9wbGFudHVtbCAxLjIwMjYuMT8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgZGF0YS1kaWFncmFtLXR5cGU9IkRFU0NSSVBUSU9OIiBoZWlnaHQ9IjIzOXB4IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIiBzdHlsZT0id2lkdGg6Nzg4cHg7aGVpZ2h0OjIzOXB4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc4OCAyMzkiIHdpZHRoPSI3ODhweCIgem9vbUFuZFBhbj0ibWFnbmlmeSI+PHRpdGxlPiYjMTI0NzM7JiMxMjQ5MDsmIzEyNDgzOyYjMTI1MDM7JiMxMjQ3MTsmIzEyNTE5OyYjMTI0ODM7JiMxMjQ4ODsmIzEyMzk1OyYjMTI0MjQ7JiMxMjQyNzsmIzI2MzY4OyYjMzY5Njk7JiMyMTI3MDs8L3RpdGxlPjxkZWZzLz48Zz48ZyBjbGFzcz0idGl0bGUiIGRhdGEtc291cmNlLWxpbmU9IjEiPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTUuOTk5MSIgeD0iMjg5LjE3MzEiIHk9IjIyLjk5NTEiPiYjMTI0NzM7JiMxMjQ5MDsmIzEyNDgzOyYjMTI1MDM7JiMxMjQ3MTsmIzEyNTE5OyYjMTI0ODM7JiMxMjQ4ODsmIzEyMzk1OyYjMTI0MjQ7JiMxMjQyNzsmIzI2MzY4OyYjMzY5Njk7JiMyMTI3MDs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgd2l0aG91dC0tPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IndpdGhvdXQiIGRhdGEtc291cmNlLWxpbmU9IjQiIGlkPSJlbnQwMDAyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1OS45OTk0IiB4PSI3IiB5PSIxMTUuOTc2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzOS45OTk0IiB4PSIxNyIgeT0iMTM4Ljk3MiI+JiMxMjQ3MzsmIzEyNDkwOyYjMTI0ODM7JiMxMjUwMzsmIzEyNDcxOyYjMTI1MTk7JiMxMjQ4MzsmIzEyNDg4OyYjMTIzOTQ7JiMxMjM3NTs8L3RleHQ+PC9nPjxnIGNsYXNzPSJlbnRpdHkiIGRhdGEtcXVhbGlmaWVkLW5hbWU9IkdNTjMiIGRhdGEtc291cmNlLWxpbmU9IjYiIGlkPSJlbnQwMDA0Ij48cGF0aCBkPSJNMzQ2LDQzLjI5NjkgTDM0Niw5NC44MDY5IEwxNjcuNDMsMTIzLjIzNjkgTDM0NiwxMDIuODA2OSBMMzQ2LDEyOC45NjA5IEEwLDAgMCAwIDAgMzQ2LDEyOC45NjA5IEw1MzIuMTA5LDEyOC45NjA5IEEwLDAgMCAwIDAgNTMyLjEwOSwxMjguOTYwOSBMNTMyLjEwOSw1My4yOTY5IEw1MjIuMTA5LDQzLjI5NjkgTDM0Niw0My4yOTY5IEEwLDAgMCAwIDAgMzQ2LDQzLjI5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik01MjIuMTA5LDQzLjI5NjkgTDUyMi4xMDksNTMuMjk2OSBMNTMyLjEwOSw1My4yOTY5IEw1MjIuMTA5LDQzLjI5NjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5LjY0NSIgeD0iMzUyIiB5PSI2MC4zNjM4Ij5FdmVudCAxPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ5LjY0NSIgeD0iMzUyIiB5PSI3NS40OTY2Ij5FdmVudCAyPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjMwLjA0MzUiIHg9IjM1MiIgeT0iOTAuNjI5NCI+LSAuLi4gLTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NC40NTgiIHg9IjM1MiIgeT0iMTA1Ljc2MjIiPkV2ZW50IDEwMDA8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY1LjEwOSIgeD0iMzUyIiB5PSIxMjAuODk1Ij4mIzg1OTQ7IDEwMDAmIzEyNDUyOyYjMTI1MDU7JiMxMjUzMTsmIzEyNDg4OyYjMTI0MzQ7JiMyNzU5ODsmIzIyMjM4OyYjMjA4Nzc7JiMyOTk4Mzs8L3RleHQ+PC9nPjwhLS1lbnRpdHkgd2l0aFNuYXBzaG90LS0+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0id2l0aFNuYXBzaG90IiBkYXRhLXNvdXJjZS1saW5lPSIxMyIgaWQ9ImVudDAwMDYiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzYuMjk2OSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU5Ljk5OTQiIHg9IjM1OS4wNSIgeT0iMTYzLjk3NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzkuOTk5NCIgeD0iMzY5LjA1IiB5PSIxODYuOTcyIj4mIzEyNDczOyYjMTI0OTA7JiMxMjQ4MzsmIzEyNTAzOyYjMTI0NzE7JiMxMjUxOTsmIzEyNDgzOyYjMTI0ODg7JiMxMjM1NDsmIzEyNDI2OzwvdGV4dD48L2c+PGcgY2xhc3M9ImVudGl0eSIgZGF0YS1xdWFsaWZpZWQtbmFtZT0iR01ONyIgZGF0YS1zb3VyY2UtbGluZT0iMTUiIGlkPSJlbnQwMDA4Ij48cGF0aCBkPSJNNTkzLjExLDEzMS43MjY5IEw1OTMuMTEsMTc4LjEyNjkgTDUxOS4zLDE4Mi4xMjY5IEw1OTMuMTEsMTg2LjEyNjkgTDU5My4xMSwyMzIuNTIzOCBBMCwwIDAgMCAwIDU5My4xMSwyMzIuNTIzOCBMNzgxLjM0NTQsMjMyLjUyMzggQTAsMCAwIDAgMCA3ODEuMzQ1NCwyMzIuNTIzOCBMNzgxLjM0NTQsMTQxLjcyNjkgTDc3MS4zNDU0LDEzMS43MjY5IEw1OTMuMTEsMTMxLjcyNjkgQTAsMCAwIDAgMCA1OTMuMTEsMTMxLjcyNjkiIGZpbGw9IiNGRUZGREQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjxwYXRoIGQ9Ik03NzEuMzQ1NCwxMzEuNzI2OSBMNzcxLjM0NTQsMTQxLjcyNjkgTDc4MS4zNDU0LDE0MS43MjY5IEw3NzEuMzQ1NCwxMzEuNzI2OSIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY3LjIzNTQiIHg9IjU5OS4xMSIgeT0iMTQ4Ljc5MzgiPlNuYXBzaG90IChFdmVudCA5MDAmIzI2MTc4OyYjMjg4NTc7KTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2Ni4xODciIHg9IjU5OS4xMSIgeT0iMTYzLjkyNjYiPkV2ZW50IDkwMTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2Ni4xODciIHg9IjU5OS4xMSIgeT0iMTc5LjA1OTQiPkV2ZW50IDkwMjwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzMC4wNDM1IiB4PSI1OTkuMTEiIHk9IjE5NC4xOTIyIj4tIC4uLiAtPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc0LjQ1OCIgeD0iNTk5LjExIiB5PSIyMDkuMzI1Ij5FdmVudCAxMDAwPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0My44MzgiIHg9IjU5OS4xMSIgeT0iMjI0LjQ1NzgiPiYjODU5NDsgMTAwJiMxMjQ1MjsmIzEyNTA1OyYjMTI1MzE7JiMxMjQ4ODsmIzEyMzk4OyYjMTI0MTU7JiMyMDg3NzsmIzI5OTgzOzwvdGV4dD48L2c+PCEtLWxpbmsgd2l0aG91dCB0byB3aXRoU25hcHNob3QtLT48ZyBjbGFzcz0ibGluayIgZGF0YS1lbnRpdHktMT0iZW50MDAwMiIgZGF0YS1lbnRpdHktMj0iZW50MDAwNiIgZGF0YS1saW5rLXR5cGU9ImRlcGVuZGVuY3kiIGRhdGEtc291cmNlLWxpbmU9IjIzIiBpZD0ibG5rMTAiPjxwYXRoIGQ9Ik0xNjcuNDMsMTQ1LjAxNjkgQzIyNC42MiwxNTIuODY2OSAyOTUuNTA1NiwxNjIuNTgxOCAzNTIuNjg1NiwxNzAuNDIxOCIgZmlsbD0ibm9uZSIgaWQ9IndpdGhvdXQtdG8td2l0aFNuYXBzaG90IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNTguNjMsMTcxLjIzNjksMzUwLjI1NjgsMTY2LjA1MTQsMzUzLjY3NjMsMTcwLjU1NzcsMzQ5LjE3MDEsMTczLjk3NzIsMzU4LjYzLDE3MS4yMzY5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjE7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE3LjAwMDEiIHg9IjE5OCIgeT0iMTQ1LjcyMzgiPiYjMTI0OTc7JiMxMjUwMTsmIzEyNDU3OyYjMTI1NDA7JiMxMjUxMDsmIzEyNTMxOyYjMTI0NzM7JiMyNTkxMzsmIzIxODkyOzwvdGV4dD48L2c+PD9wbGFudHVtbC1zcmMgWlAzRElpRDA1OE50eW5JTmhkSUhDN01kMnRTLVdLeUd4Qkc5YjFiZkh6cnN4ZkxJd1d6T1Fhakh3YVFHQWtaMlhHRzR0d01OZkZXTWNmZTRZWi11Y2V5cFNFT3hPb0ZSTEMwT0NfTVBZNmRDLUM5cWotR1VrbVY2N2tEOVVqcnZUeEZhVDJJUWdjeDE2Y1g1WlQxMkJNZ2ZGSGlQQktHNldNdnlqYkwtaHhqZER3djBxOFFabzhSY20wZmpoQ2d4SkJyQ1Rtd0xqYjNEcG10WFdVX3h1MU12YjVCQ2t1Q2JDRHVvSlBZVWl0dVNmNF9kb1RLcXdQdWpYWlQyd0hmYTNfbkozWGR4ZlRvazNsUlJlVmQ5aUJtZzBEUS1uM1FiSjJVdW03WFQ1NDZyZkJ6TWg4bm1aLXBVbFl0OGxtT3lSdGo1MGhRMHdPQmZhZDc2ekNlcXBNZW1KZVRuQ1poLTAwMDA/PjwvZz48L3N2Zz4=" class="uml" alt="uml diagram" title="" /></p>
<h3 id="_12">スナップショットテーブル<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">aggregate_snapshot</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">aggregate_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">aggregate_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">snapshot_version</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">snapshot_data</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>
</code></pre></div>
<h3 id="_13">スナップショットの実装<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// domain/repository/SnapshotRepository.java</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">SnapshotRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">AggregateSnapshot</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">aggregateState</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// infrastructure/persistence/SnapshotRepositoryImpl.java</span>
<span class="nd">@Repository</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SnapshotRepositoryImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">SnapshotRepository</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SnapshotMapper</span><span class="w"> </span><span class="n">snapshotMapper</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SNAPSHOT_THRESHOLD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">AggregateSnapshot</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SnapshotEntity</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshotMapper</span><span class="p">.</span><span class="na">selectByAggregateId</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AggregateSnapshot</span><span class="p">(</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">getAggregateId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">getSnapshotVersion</span><span class="p">(),</span>
<span class="w">            </span><span class="n">entity</span><span class="p">.</span><span class="na">getSnapshotData</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveSnapshot</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">aggregateState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">snapshotData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toJson</span><span class="p">(</span><span class="n">aggregateState</span><span class="p">);</span>
<span class="w">        </span><span class="n">snapshotMapper</span><span class="p">.</span><span class="na">upsertSnapshot</span><span class="p">(</span>
<span class="w">            </span><span class="n">aggregateId</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;JournalEntry&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">version</span><span class="p">,</span>
<span class="w">            </span><span class="n">snapshotData</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">shouldTakeSnapshot</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">SNAPSHOT_THRESHOLD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="aggregate_1">スナップショット対応の Aggregate 再生<a class="headerlink" href="#aggregate_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1">// application/service/JournalEntryEventSourcingService.java</span>
<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JournalEntryEventSourcingService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">EventStoreRepository</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SnapshotRepository</span><span class="w"> </span><span class="n">snapshotRepository</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="nf">loadAggregate</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. スナップショットを取得</span>
<span class="w">        </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">AggregateSnapshot</span><span class="o">&gt;</span><span class="w"> </span><span class="n">snapshotOpt</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">snapshotRepository</span><span class="p">.</span><span class="na">getSnapshot</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>

<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">fromVersion</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">snapshotOpt</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// スナップショットから復元</span>
<span class="w">            </span><span class="n">AggregateSnapshot</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshotOpt</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deserializeAggregate</span><span class="p">(</span><span class="n">snapshot</span><span class="p">.</span><span class="na">getSnapshotData</span><span class="p">());</span>
<span class="w">            </span><span class="n">fromVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snapshot</span><span class="p">.</span><span class="na">getVersion</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// スナップショットなし、最初から再生</span>
<span class="w">            </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">();</span>
<span class="w">            </span><span class="n">fromVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 2. スナップショット以降のイベントを取得して再生</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span>
<span class="w">            </span><span class="p">.</span><span class="na">getEventsFromVersion</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">fromVersion</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">events</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">apply</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 3. 必要に応じてスナップショットを保存</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getVersion</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">snapshotRepository</span><span class="p">.</span><span class="na">shouldTakeSnapshot</span><span class="p">(</span><span class="n">currentVersion</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">snapshotRepository</span><span class="p">.</span><span class="na">saveSnapshot</span><span class="p">(</span>
<span class="w">                </span><span class="n">aggregateId</span><span class="p">,</span>
<span class="w">                </span><span class="n">currentVersion</span><span class="p">,</span>
<span class="w">                </span><span class="n">aggregate</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">aggregate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="316-tdd">31.6 TDD による実装例<a class="headerlink" href="#316-tdd" title="Permanent link">&para;</a></h2>
<h3 id="_14">イベントソーシングのテスト<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ActiveProfiles</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">JournalEntryEventSourcingTest</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">JournalEntryCommandService</span><span class="w"> </span><span class="n">commandService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EventStoreRepository</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳を作成するとJournalEntryCreatedEventが保存される&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldCreateJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">CreateJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateJournalEntryCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">entryDate</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;売上計上&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">lineItems</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">LineItem</span><span class="p">(</span><span class="s">&quot;1111&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DebitCredit</span><span class="p">.</span><span class="na">DEBIT</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">)),</span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">LineItem</span><span class="p">(</span><span class="s">&quot;4111&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DebitCredit</span><span class="p">.</span><span class="na">CREDIT</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;100000&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">userId</span><span class="p">(</span><span class="s">&quot;user-001&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandService</span><span class="p">.</span><span class="na">createJournalEntry</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">events</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">events</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

<span class="w">        </span><span class="n">JournalEntryCreatedEvent</span><span class="w"> </span><span class="n">createdEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">JournalEntryCreatedEvent</span><span class="p">)</span><span class="w"> </span><span class="n">events</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">.</span><span class="na">getDescription</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="s">&quot;売上計上&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">createdEvent</span><span class="p">.</span><span class="na">getLineItems</span><span class="p">()).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;仕訳を承認するとJournalEntryApprovedEventが追加される&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldApproveJournalEntry</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestJournalEntry</span><span class="p">();</span>

<span class="w">        </span><span class="n">ApproveJournalEntryCommand</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ApproveJournalEntryCommand</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">journalEntryId</span><span class="p">(</span><span class="n">journalId</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">approvedBy</span><span class="p">(</span><span class="s">&quot;manager-001&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">comment</span><span class="p">(</span><span class="s">&quot;承認します&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">commandService</span><span class="p">.</span><span class="na">approveJournalEntry</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">events</span><span class="p">).</span><span class="na">hasSize</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">events</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">JournalEntryApprovedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;イベント再生で過去の状態を復元できる&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldReplayEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestJournalEntry</span><span class="p">();</span>
<span class="w">        </span><span class="n">approveJournalEntry</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>
<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">.</span><span class="na">replay</span><span class="p">(</span><span class="n">events</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">aggregate</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">APPROVED</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">aggregate</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;特定時点の状態を復元できる&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldReplayEventsUntilPointInTime</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestJournalEntry</span><span class="p">();</span>
<span class="w">        </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="n">beforeApproval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w">  </span><span class="c1">// 時間経過</span>
<span class="w">        </span><span class="n">approveJournalEntry</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When: 承認前の時点の状態を復元</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eventsUntil</span><span class="w"> </span><span class="o">=</span>
<span class="w">            </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEventsUntil</span><span class="p">(</span><span class="n">journalId</span><span class="p">,</span><span class="w"> </span><span class="n">beforeApproval</span><span class="p">);</span>
<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">.</span><span class="na">replay</span><span class="p">(</span><span class="n">eventsUntil</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Then</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">aggregate</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">JournalEntryStatus</span><span class="p">.</span><span class="na">DRAFT</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Test</span>
<span class="w">    </span><span class="nd">@DisplayName</span><span class="p">(</span><span class="s">&quot;楽観ロックにより同時更新が検出される&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">shouldDetectConcurrentModification</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Given</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">journalId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestJournalEntry</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// ユーザー1とユーザー2が同時にイベントを取得</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">journalId</span><span class="p">);</span>

<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">.</span><span class="na">replay</span><span class="p">(</span><span class="n">events1</span><span class="p">);</span>
<span class="w">        </span><span class="n">JournalEntryAggregate</span><span class="w"> </span><span class="n">aggregate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JournalEntryAggregate</span><span class="p">.</span><span class="na">replay</span><span class="p">(</span><span class="n">events2</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// ユーザー1が先に承認</span>
<span class="w">        </span><span class="n">aggregate1</span><span class="p">.</span><span class="na">approve</span><span class="p">(</span><span class="s">&quot;user1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;承認1&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span>
<span class="w">            </span><span class="n">journalId</span><span class="p">,</span>
<span class="w">            </span><span class="n">aggregate1</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">(),</span>
<span class="w">            </span><span class="n">aggregate1</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// When/Then: ユーザー2が同じバージョンで更新しようとするとエラー</span>
<span class="w">        </span><span class="n">aggregate2</span><span class="p">.</span><span class="na">approve</span><span class="p">(</span><span class="s">&quot;user2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;承認2&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">assertThatThrownBy</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span>
<span class="w">                </span><span class="n">journalId</span><span class="p">,</span>
<span class="w">                </span><span class="n">aggregate2</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">(),</span>
<span class="w">                </span><span class="n">aggregate2</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="na">isInstanceOf</span><span class="p">(</span><span class="n">ConcurrentModificationException</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="317">31.7 まとめ<a class="headerlink" href="#317" title="Permanent link">&para;</a></h2>
<p>本章では、イベントソーシングパターンについて解説しました。</p>
<h3 id="_15">学んだこと<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>イベントソーシングの基礎</strong>: 状態ではなくイベントを保存する設計パターン</li>
<li><strong>CRUD との違い</strong>: Append-Only、イベント再生、タイムトラベル</li>
<li><strong>イベントストアの設計</strong>: PostgreSQL JSONB、インデックス戦略、バージョニング</li>
<li><strong>Aggregate パターン</strong>: コマンドからイベントを発行、イベントを適用して状態を更新</li>
<li><strong>CQRS パターン</strong>: Command と Query の分離、読み取りモデルの構築</li>
<li><strong>スナップショット</strong>: パフォーマンス最適化のための状態保存</li>
</ol>
<h3 id="_16">財務会計システムへの適用<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>観点</th>
<th>イベントソーシングの利点</th>
</tr>
</thead>
<tbody>
<tr>
<td>監査証跡</td>
<td>すべての変更が自動的に記録される</td>
</tr>
<tr>
<td>法令対応</td>
<td>電子帳簿保存法、J-SOX 要件を満たす</td>
</tr>
<tr>
<td>タイムトラベル</td>
<td>期末残高、過去時点の状態を正確に復元</td>
</tr>
<tr>
<td>デバッグ</td>
<td>問題の原因をイベントから特定</td>
</tr>
<tr>
<td>柔軟性</td>
<td>新しいレポート要件に過去イベントで対応</td>
</tr>
</tbody>
</table>
<h3 id="_17">導入の判断基準<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>イベントソーシングを導入すべきか？

✅ 監査証跡が法的に必要 → 導入を検討
✅ 過去時点の状態復元が必要 → 導入を検討
✅ 複雑なドメインロジック → DDD + ES で効果的
✅ イベント駆動アーキテクチャを採用 → 自然な選択

❌ シンプルな CRUD で十分 → 不要
❌ チームの経験不足 → 段階的導入または見送り
❌ パフォーマンス最優先 → 慎重に検討
</code></pre></div>
<p>次章では、境界付けられたコンテキスト（Bounded Context）と DDD 戦略的設計について解説します。</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k2works/case-study-accounting" target="_blank" rel="noopener" title="財務会計システム ケーススタディ" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="../../../assets/js/extra.js"></script>
      
    
  </body>
</html>