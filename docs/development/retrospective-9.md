# イテレーション 9 ふりかえり

## イテレーション情報

| 項目 | 内容 |
|------|------|
| イテレーション番号 | 9 |
| 期間 | 2026-02-18 〜 2026-02-19（実質 2 日） |
| 実施日 | 2026-02-19 |
| 参加者 | Claude Opus 4.6, Codex |
| フォーマット | KPT（Keep / Problem / Try） |

---

## 実績サマリー

### 完了状況

| 指標 | 計画 | 実績 | 達成率 |
|------|------|------|--------|
| ストーリーポイント | 13SP | 13SP | 100% |
| ストーリー数 | 4 | 4 | 100% |
| バックエンドテスト | - | 757 パス | ✅ |
| フロントエンドテスト | - | 585 パス | ✅ |
| ビルド状態 | - | 成功 | ✅ |

### 主要成果物

| ストーリーID | ストーリー名 | SP | 状態 | 完了日 |
|-------------|-------------|-----|------|--------|
| US-MST-005 | 勘定科目構成登録 | 5 | ✅ 完了 | 2026-02-18 |
| US-MST-006 | 勘定科目構成編集 | 3 | ✅ 完了 | 2026-02-19 |
| US-MST-007 | 自動仕訳設定登録 | 3 | ✅ 完了 | 2026-02-19 |
| US-MST-008 | 自動仕訳設定編集 | 2 | ✅ 完了 | 2026-02-19 |

### コード変更統計

| メトリクス | 値 |
|-----------|-----|
| 新規ファイル数（自動仕訳パターン） | 35 |
| 変更ファイル数（既存） | 5 |
| 新規コード行数（推定） | 4,100+ |
| バックエンド新規ファイル | 26（ドメイン/ポート/サービス/永続化/Web） |
| フロントエンド新規ファイル | 9（API/ページ/ビュー/E2E） |

---

## KPT 分析

### Keep（続けること）

#### 技術的成功事項

1. **既存マスタ管理パターンの完全な再利用に成功**

   - 勘定科目 CRUD パターン（IT-1/2）を勘定科目構成と自動仕訳パターンに適用
   - ヘキサゴナルアーキテクチャの Command → UseCase → Service → Repository パターンが安定
   - フロントエンドの一覧/登録/編集ページパターンも再利用可能な形に成熟

2. **1:N リレーションパターンの確立**

   - AutoJournalPattern（1対多: AutoJournalPatternItem）を JournalEntry パターンから再利用
   - MyBatis ResultMap with `<collection notNullColumn="item_id">` LEFT JOIN パターンが定着
   - Save 戦略（insert/update + deleteItems + insertItems）が標準化

3. **record + List フィールドの SpotBugs 対応パターン**

   - Java record with List field needs compact constructor with `List.copyOf()`
   - このパターンが自動仕訳パターンのドメインモデルで確認・適用

4. **E2E テストの充実**

   - 勘定科目構成: 19 テストケース
   - 自動仕訳パターン: E2E テスト追加
   - マスタ管理機能全体のリグレッション防止を確立

5. **マスタ管理カテゴリ全 8 ストーリー完了**

   - US-MST-001〜008 の全ストーリーが完了
   - 勘定科目 CRUD（IT-1/2）→ 勘定科目構成（IT-9）→ 自動仕訳パターン（IT-9）
   - マスタ管理の 29SP が 100% 消化

#### プロセス的成功事項

1. **リリース 3.0 の最初のイテレーションを計画通り完了**

   - 13SP/13SP 達成率 100%
   - 計画 10 日に対して 2 日で完了
   - IT-8 のパターン再利用可能性評価が正しかった

2. **GitHub Project との同期**

   - Issue #13（US-MST-006）、#14（US-MST-007）、#15（US-MST-008）クローズ
   - Project Board 同期完了

#### チームワーク

1. **Claude + Codex の並列開発が成熟**

   - Claude: 設計・計画・E2E テスト・ドキュメント
   - Codex: TDD 実装・ユニットテスト・UI 実装
   - 4 ストーリーを 2 日で完了する効率を実現

---

### Problem（問題点・課題）

#### 見積もり精度の乖離（継続課題）

1. **計画期間と実績期間の大幅な乖離**

   - 計画: 10 日間（2026-02-18 〜 2026-03-03）
   - 実績: 2 日（2026-02-18 〜 2026-02-19）
   - 乖離率 5:1、IT-8（10:1）よりは改善したが依然として大きい
   - 4 ストーリー（13SP）はパターン再利用により大幅に短縮

2. **SP 見積もりと AI 実装速度の不一致（継続）**

   - US-MST-005 は 5SP だが既存テーブル活用で 1 日完了
   - US-MST-007/008 は合計 5SP だが勘定科目パターン再利用で 1 日完了
   - パターン再利用可能な場合、SP の 1/5 程度の工数で完了する傾向

#### SonarQube Quality Gate の未確認（3 イテレーション連続）

1. **CARRY-01 タスクが IT-7 から 3 イテレーション連続で未完了**

   - テストカバレッジは高水準維持（バックエンド 757、フロントエンド 585）
   - 実質的リスクは低いが、品質保証プロセスとしての確認が必要
   - IT-10 で確実に実施する必要がある

#### 未コミット変更の蓄積

1. **US-MST-007/008 の実装コードが未コミット**

   - 35 ファイルの新規コードがワーキングツリーに存在
   - コミット前のレビュー・整理が必要

---

### Try（次に試すこと）

| # | アクション | 責任者 | 期限 | 内容 | 期待効果 |
|---|-----------|--------|------|------|----------|
| 1 | SonarQube Quality Gate 確認 | Claude | IT-10 初日 | 3 イテレーション分の Quality Gate 確認を確実に実施 | 品質保証の確認 |
| 2 | 未コミット変更の整理・コミット | Claude | IT-9 完了時 | US-MST-007/008 のコードを適切な粒度でコミット | コード管理の健全化 |
| 3 | IT-10 計画での「パターン新規度」評価 | Claude | IT-10 計画時 | US-JNL-006（自動仕訳生成）は新規パターン要素が多いため、余裕を持った計画に | 計画精度向上 |
| 4 | リリース完了チェックリストの標準化 | Claude | IT-10 | コミット・Quality Gate・ドキュメント更新の完了確認リストを標準化 | 漏れ防止 |

---

## 次イテレーションへの引き継ぎ事項

### IT-10 計画準備

1. **IT-10 計画作成**: US-JNL-006（自動仕訳生成 5SP）+ US-FS-003（財務分析表示 5SP）= 10SP
2. **SonarQube Quality Gate 確認**: IT-7, IT-8, IT-9 での保留事項を解消
3. **US-JNL-006 は IT-9 の US-MST-007/008 が前提**: 自動仕訳パターンマスタを使って自動仕訳を生成

### Release 3.0 残スコープ（残 23SP）

| イテレーション | ストーリー | SP |
|--------------|-----------|-----|
| IT-10 | US-JNL-006, US-FS-003（自動仕訳生成・財務分析） | 10 |
| IT-11 | US-SYS-001, US-SYS-002（監査ログ・データダウンロード） | 13 |
| IT-12 | バッファ・統合テスト・リリース準備 | 10 |

---

## メトリクス

### 品質メトリクス

| メトリクス | バックエンド | フロントエンド |
|-----------|-------------|---------------|
| テストケース数 | 757 | 585 |
| テスト合格率 | 100% | 100% |
| ビルド状態 | ✅ 成功 | ✅ 成功 |

### プロセスメトリクス

| メトリクス | 計画 | 実績 |
|-----------|------|------|
| イテレーション期間 | 10 日 | 2 日 |
| ベロシティ | 13SP | 13SP |
| 達成率 | 100% | 100% |

---

## ベロシティ推移

### 全イテレーション実績（Release 1.0 + Release 2.0 + Release 3.0）

| イテレーション | 計画 SP | 実績 SP | 計画期間 | 実績期間 | リリース |
|---------------|---------|---------|----------|----------|----------|
| 1 | 15 | 18 | 2 週間 | 2 週間 | 1.0 |
| 2 | 14 | 16 | 2 週間 | 1 週間 | 1.0 |
| 3 | 18 | 18 | 2 週間 | 1 週間 | 1.0 |
| 4 | 10 | 10 | 2 週間 | 2 日 | 1.0 |
| 5 | 17 | 17 | 2 週間 | 3 日 | 2.0 |
| 6 | 19 | 19 | 2 週間 | 4 日 | 2.0 |
| 7 | 13 | 13 | 2 週間 | 3 日 | 2.0 |
| 8 | 8 | 8 | 2 週間 | 1 日 | 2.0 |
| 9 | 13 | 13 | 2 週間 | 2 日 | 3.0 |
| **累計** | **127** | **132** | **18 週間** | **約 5.5 週間** | |

**平均ベロシティ**: 14.7 SP/イテレーション
**実績累計期間効率**: 132SP / 約 5.5 週間 = 約 24.0 SP/週

---

## 学び（Lessons Learned）

### 技術的学び

1. **マスタ管理パターンの成熟**

   - 勘定科目 CRUD → 勘定科目構成 → 自動仕訳パターンと、3 段階でパターンが進化
   - 最初のパターン確立（IT-1/2）に投資した時間が、IT-9 で大きく回収された
   - 1:N リレーション（JournalEntry → 自動仕訳パターン）のパターンも標準化

2. **record + List の SpotBugs 対応**

   - Java record with List field は compact constructor で `List.copyOf()` が必須
   - この学びはプロジェクト全体のドメインモデル設計に適用可能

3. **PMD 抑制アノテーションの最小化**

   - AutoJournalPatternEntity は `AvoidMutableCollectionInstantiation` + `BooleanGetMethodName` のみ
   - Entity クラスの PMD 抑制を最小限に保つパターンが定着

### プロセス的学び

1. **パターン再利用可能性の事前評価が計画精度を向上**

   - IT-8 ふりかえりで「パターン有無が工数決定要因」と学んだことを IT-9 計画に反映
   - 4 ストーリー全てがパターン再利用可能で、計画 13SP を 2 日で達成
   - IT-10 では US-JNL-006（自動仕訳生成）が新規パターン要素を含むため注意が必要

2. **マスタ管理の完全完了がもたらす安定感**

   - 29SP の全 8 ストーリーが完了し、マスタ管理カテゴリが 100% 消化
   - 基盤データ管理の安定が、上位機能（自動仕訳生成、財務分析）の実装を支える

---

## 総評

### 成功した点

- **4 ストーリー（13SP）を 2 日で全完了**: マスタ管理パターンの再利用で高効率を実現
- **マスタ管理カテゴリ全 8 ストーリー（29SP）完了**: リリース 1.0 からの積み上げで完全消化
- **テスト 1,342 件が全件パス**: バックエンド 757 + フロントエンド 585
- **1:N リレーションパターンの標準化**: JournalEntry パターンを自動仕訳パターンに適用
- **Release 3.0 の順調な滑り出し**: 初回イテレーションで 13SP/13SP 達成

### 改善が必要な点

- **SonarQube Quality Gate**: 3 イテレーション連続で未確認（IT-10 で必ず実施）
- **見積もり精度**: 計画 10 日 → 実績 2 日（乖離率 5:1）
- **未コミット変更**: US-MST-007/008 のコードが未コミットのまま蓄積

### 総合評価

イテレーション 9 は**成功**でした。リリース 3.0 完成版の最初のイテレーションとして、マスタ拡張機能 4 ストーリー（13SP）を 2 日で 100% 達成しました。累計 132SP を完了し、プロジェクト全体の 85.2% が完了しています。

IT-1/2 で確立した勘定科目 CRUD パターン、IT-4 で確立した元帳照会パターン、IT-7/8 で確立した財務諸表パターンに続き、IT-9 では 1:N リレーションを含むマスタ管理パターンが標準化されました。次の IT-10 では US-JNL-006（自動仕訳生成）と US-FS-003（財務分析表示）を実装します。自動仕訳生成は IT-9 で構築した自動仕訳パターンマスタを前提とする新規機能であり、パターン再利用度は中程度と予想されます。

---

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|---------|--------|
| 2026-02-19 | 初版作成 | Claude Opus 4.6 |

---

## 関連ドキュメント

- [イテレーション 9 計画](./iteration_plan-9.md)
- [イテレーション 8 ふりかえり](./retrospective-8.md)
- [リリース計画](./release_plan.md)
- [ユーザーストーリー](../requirements/user_story.md)
