# イテレーション 8 ふりかえり

## イテレーション情報

| 項目 | 内容 |
|------|------|
| イテレーション番号 | 8 |
| 期間 | 2026-02-17（実質 1 日） |
| 実施日 | 2026-02-18 |
| 参加者 | Claude Opus 4.6, Codex |
| フォーマット | KPT（Keep / Problem / Try） |

---

## 実績サマリー

### 完了状況

| 指標 | 計画 | 実績 | 達成率 |
|------|------|------|--------|
| ストーリーポイント | 8SP | 8SP | 100% |
| ストーリー数 | 1 | 1 | 100% |
| コミット数 | - | 26 | - |
| バックエンドテスト | - | 718 パス | ✅ |
| フロントエンドテスト | - | 585 パス | ✅ |
| ビルド状態 | - | 成功 | ✅ |

### 主要成果物

| ストーリーID | ストーリー名 | SP | 状態 | 完了日 |
|-------------|-------------|-----|------|--------|
| US-FS-002 | 損益計算書表示 | 8 | ✅ 完了 | 2026-02-17 |

### コード変更統計

| メトリクス | 値 |
|-----------|-----|
| 総コミット数 | 26 |
| 変更ファイル数 | 204 |
| 追加行数 | 9,334 |
| 削除行数 | 2,227 |
| 純増行数 | 7,107 |
| コミット内訳 - refactor | 13 |
| コミット内訳 - feat | 4 |
| コミット内訳 - test | 3 |
| コミット内訳 - docs | 3 |
| コミット内訳 - fix | 2 |
| コミット内訳 - chore | 1 |

---

## KPT 分析

### Keep（続けること）

#### 技術的成功事項

1. **貸借対照表パターンの完全な再利用に成功**

   - IT-7 で確立した BalanceSheetRepository/Service/Controller + PDF/Excel エクスポートパターンを損益計算書に適用
   - 2 コミット（バックエンド + フロントエンド）で主要機能を実装完了
   - 期間指定クエリ（dateFrom/dateTo）や前期比較ロジックも BS パターンからの差分変更のみで実現

2. **BS/PL 間の重複コード解消（リファクタリングの徹底）**

   - バックエンド: Entity・ExportService の共通ロジックを抽出
   - フロントエンド: 財務諸表コンポーネントの共通パターンを統合
   - 構造変更と動作変更を分離し、refactor 13 コミットで品質を担保

3. **PMD 関数型プログラミングルールの全対応完了**

   - Repository 全メソッドの戻り値を Try\<T\> でラップ
   - Domain Value Object の AvoidThrowStatement を validated() に変換
   - Command/Query の AvoidThrowStatement を Either factory に変換
   - AvoidCheckedExceptionDeclaration、AvoidMutableCollectionInstantiation の @SuppressWarnings を全除去

4. **SonarQube 指摘への事前対応**

   - バックエンド: ユニットテスト 20 件追加
   - フロントエンド: ユニットテスト 43 件追加、重複コード解消
   - テストカバレッジの高水準維持（バックエンド 718 テスト、フロントエンド 585 テスト）

5. **ページネーション楽観的更新パターンの適用**

   - IT-7 で発見した制御コンポーネントリセット問題を IT-8 開始時に修正
   - フロントエンド権限チェック実装に伴う E2E テスト修正も実施

#### プロセス的成功事項

1. **リリース 2.0 を計画通り完了**

   - 全 12 ストーリー（57SP）が 100% 達成
   - IT-5 から IT-8 まで 4 イテレーション連続で計画 SP を達成
   - リリース 2.0 の全受入条件を満たす

2. **リファクタリングに十分な時間を確保**

   - 8SP のストーリーを 1 日で完了し、残り時間をリファクタリングに充当
   - 26 コミット中 13 コミット（50%）がリファクタリング

3. **GitHub Project との同期完了**

   - Issue #32 クローズ、Project Board に Release 3.0 の Issue #32-35 追加
   - Milestone「リリース 1.0 MVP」クローズ

#### チームワーク

1. **パターン再利用による効率最大化**

   - Claude: 設計・計画・E2E テスト・リファクタリング・ドキュメント
   - Codex: TDD 実装・ユニットテスト・UI 実装
   - 両者の役割分担が安定し、1 日で 8SP + リファクタリングを完了

---

### Problem（問題点・課題）

#### 見積もり精度の乖離（継続課題）

1. **計画期間と実績期間の大幅な乖離**

   - 計画: 10 日間（2026-02-17 〜 2026-03-02）
   - 実績: 1 日（2026-02-17）
   - 過去最大の乖離（10:1）、AI アシスタント活用時のベロシティは計画の 10 倍
   - IT-7 のふりかえりで指摘した問題が更に顕著に

2. **SP 見積もりと AI 実装速度の不一致**

   - US-FS-002 は 8SP（最高レベル）だが、既存パターンの再利用で 1 日完了
   - SP が複雑度を反映しても、パターン再利用可能な場合の工数は大幅に低減
   - Release 3.0 の計画ではこの学びを反映すべき

#### SonarQube Quality Gate の未確認（継続課題）

1. **Quality Gate パスの確認が IT-7 から継続して未完了**

   - IT-7, IT-8 共に Try に記載したが、最終確認が実施されていない
   - テストカバレッジは高水準を維持しているため実質的リスクは低い

#### リリースノート v2.0 の未作成

1. **Release 2.0 完了にもかかわらずリリースノートが未作成**

   - v1.0 リリースノートは COMMON-18 で IT-7 に作成済み
   - v2.0 のリリースノート作成が未計画

---

### Try（次に試すこと）

| # | アクション | 責任者 | 期限 | 内容 | 期待効果 |
|---|-----------|--------|------|------|----------|
| 1 | AI ベロシティに基づく計画見直し | Claude | IT-9 計画時 | 過去 8 イテレーションの実績に基づき、AI 開発に適した計画手法を検討。計画日数の見直しまたは「リソース効率」の導入 | 計画精度の向上 |
| 2 | SonarQube Quality Gate 確認 | Claude | IT-9 初日 | 溜まっている Quality Gate 確認を IT-9 初日に実施 | 品質保証の確認 |
| 3 | Release 2.0 リリースノート作成 | Claude | IT-9 | v2.0 リリースノートを作成（v1.0 リリースノートのフォーマットを踏襲） | リリース記録の完備 |
| 4 | Release 3.0 の SP 再見積もり | Claude | IT-9 計画時 | パターン再利用可能性を考慮した SP 再評価。特に US-MST-005/006/007/008 は既存マスタ管理パターンの再利用で大幅削減の可能性 | 計画精度向上 |

---

## 次イテレーションへの引き継ぎ事項

### Release 3.0 準備事項

1. **IT-9 計画作成**: マスタ拡張機能（US-MST-005, 006, 007, 008, 13SP）
2. **リリースノート v2.0 作成**: Release 2.0 全機能の記録
3. **SonarQube Quality Gate 確認**: IT-7, IT-8 での保留事項を解消

### Release 3.0 スコープ（残 36SP）

| イテレーション | ストーリー | SP |
|--------------|-----------|-----|
| IT-9 | US-MST-005, 006, 007, 008（勘定科目構成・自動仕訳設定） | 13 |
| IT-10 | US-JNL-006, US-FS-003（自動仕訳生成・財務分析） | 10 |
| IT-11 | US-SYS-001, US-SYS-002（監査ログ・データダウンロード） | 13 |
| IT-12 | バッファ・統合テスト・リリース準備 | 10 |

---

## メトリクス

### 開発メトリクス

| メトリクス | 値 |
|-----------|-----|
| 総コミット数 | 26 |
| 変更ファイル数 | 204 |
| 追加行数 | 9,334 |
| 削除行数 | 2,227 |
| 純増行数 | 7,107 |

### 品質メトリクス

| メトリクス | バックエンド | フロントエンド |
|-----------|-------------|---------------|
| テストケース数 | 718 | 585 |
| テスト合格率 | 100% | 100% |
| ビルド状態 | ✅ 成功 | ✅ 成功 |

### プロセスメトリクス

| メトリクス | 計画 | 実績 |
|-----------|------|------|
| イテレーション期間 | 10 日 | 1 日 |
| ベロシティ | 8SP | 8SP |
| 達成率 | 100% | 100% |

---

## ベロシティ推移

### 全イテレーション実績（Release 1.0 + Release 2.0）

| イテレーション | 計画 SP | 実績 SP | 計画期間 | 実績期間 | リリース |
|---------------|---------|---------|----------|----------|----------|
| 1 | 15 | 18 | 2 週間 | 2 週間 | 1.0 |
| 2 | 14 | 16 | 2 週間 | 1 週間 | 1.0 |
| 3 | 18 | 18 | 2 週間 | 1 週間 | 1.0 |
| 4 | 10 | 10 | 2 週間 | 2 日 | 1.0 |
| 5 | 17 | 17 | 2 週間 | 3 日 | 2.0 |
| 6 | 19 | 19 | 2 週間 | 4 日 | 2.0 |
| 7 | 13 | 13 | 2 週間 | 3 日 | 2.0 |
| 8 | 8 | 8 | 2 週間 | 1 日 | 2.0 |
| **累計** | **114** | **119** | **16 週間** | **約 5 週間** | |

**平均ベロシティ**: 14.9 SP/イテレーション
**実績累計期間効率**: 119SP / 約 5 週間 = 約 23.8 SP/週

---

## 学び（Lessons Learned）

### 技術的学び

1. **パターン再利用の威力**

   - 貸借対照表パターンを損益計算書に適用し、8SP を 1 日で完了
   - Repository/Service/Controller/ExportService/Frontend の全層で再利用が有効
   - 最初のパターン確立（US-FS-001）に投資した時間が後続で回収される

2. **リファクタリングは機能追加の「前」ではなく「後」が効果的**

   - IT-8 では機能実装完了後に BS/PL 間の重複コードを解消
   - 2 つの実装が揃った状態で共通パターンを抽出する方が、事前の抽象化より効果的
   - "Rule of Three" の実践: 3 回目の重複で抽象化を検討

3. **PMD 関数型ルール対応によるコードベース品質の向上**

   - Try\<T\> ラッピング、validated() パターン、Either factory が全 Repository/Domain に浸透
   - 例外をドメイン外に隔離するアーキテクチャが確立
   - 将来の機能追加で自然にこのパターンが踏襲される

### プロセス的学び

1. **リリース完了のセレモニーを計画に組み込むべき**

   - リリースノート作成、Quality Gate 確認が漏れがち
   - IT 最終日に「リリース完了チェックリスト」を設けることで防止可能

2. **AI 開発では SP よりも「パターン有無」が工数決定要因**

   - 新規パターンの確立: 通常〜長時間（IT-1 の認証基盤など）
   - 既存パターンの再利用: 極短時間（IT-8 の損益計算書など）
   - Release 3.0 の計画では各ストーリーのパターン依存度を評価すべき

---

## リリース 2.0 機能拡張版 総括

### 達成実績

| 指標 | 値 |
|------|-----|
| 全ストーリー | 12/12 完了（100%） |
| 合計 SP | 57SP/57SP（100%） |
| 計画期間 | 8 週間（IT-5 〜 IT-8） |
| 実績期間 | 約 11 日 |
| 総コミット数（IT-5〜8） | 約 100+ |
| 総テスト数 | 1,303（バックエンド 718 + フロントエンド 585） |

### 実装した主要機能

1. **ユーザー管理**: 編集・削除・一覧表示（CRUD 完成）
2. **仕訳承認ワークフロー**: 申請 → 承認 → 差し戻し（理由付き） → 確定（元帳転記）
3. **月次残高照会**: 勘定科目別月次推移グラフ付き
4. **残高試算表**: 貸借一致検証、勘定科目種別小計
5. **貸借対照表**: 勘定式レイアウト、前期比較、PDF/Excel エクスポート
6. **補助元帳照会**: 補助科目コードフィルタリング
7. **損益計算書**: 報告式レイアウト、前期比較、PDF/Excel エクスポート

### リリース 2.0 から得た教訓

- ヘキサゴナルアーキテクチャのパターン成熟が後半イテレーションの速度を加速させた
- TDD サイクルの徹底により、全イテレーションでデグレーション 0 件を達成
- AI チーム（Claude + Codex）の並列開発は人間チームの 3〜10 倍のスループットを実現

---

## 総評

### 成功した点

- **US-FS-002 損益計算書表示を 1 日で完了（8SP）**: 貸借対照表パターンの完全な再利用に成功
- **リリース 2.0 機能拡張版を全完了（57SP, 12 ストーリー）**: 計画期間 8 週間に対し約 11 日で達成
- **リファクタリングの徹底**: コミットの 50% がリファクタリング、BS/PL 間の重複コードを解消
- **PMD 関数型プログラミングルールの全対応完了**: コードベース全体の保守性が向上
- **テスト 1,303 件が全件パス**: バックエンド 718 + フロントエンド 585

### 改善が必要な点

- **見積もり精度**: 計画 10 日 → 実績 1 日（過去最大の乖離）
- **SonarQube Quality Gate**: 2 イテレーション連続で未確認
- **リリースノート v2.0 未作成**: リリース完了のセレモニーが不足

### 総合評価

イテレーション 8 は**大成功**でした。損益計算書表示を貸借対照表パターンの再利用で効率的に実装し、リリース 2.0 機能拡張版（57SP, 12 ストーリー）を 100% 達成しました。累計 119SP を完了し、プロジェクト全体の 76.8% が完了しています。

Release 1.0 MVP（52SP, IT1-4）と Release 2.0 機能拡張版（57SP, IT5-8）を通じて、ヘキサゴナルアーキテクチャのパターンが成熟し、TDD サイクルが定着し、AI チームの開発効率が飛躍的に向上しました。次の Release 3.0 完成版（46SP, IT9-12）では、マスタ拡張・自動仕訳・財務分析・システム管理機能を実装し、プロジェクトを完成させます。

---

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|---------|--------|
| 2026-02-18 | 初版作成 | Claude Opus 4.6 |

---

## 関連ドキュメント

- [イテレーション 8 計画](./iteration_plan-8.md)
- [イテレーション 7 ふりかえり](./retrospective-7.md)
- [リリース計画](./release_plan.md)
- [ユーザーストーリー](../requirements/user_story.md)
