# イテレーション 7 ふりかえり

## イテレーション情報

| 項目 | 内容 |
|------|------|
| イテレーション番号 | 7 |
| 期間 | 2026-02-14 〜 2026-02-16（実質 3 日） |
| 実施日 | 2026-02-17 |
| 参加者 | Claude Opus 4.6, Codex |
| フォーマット | KPT（Keep / Problem / Try） |

---

## 実績サマリー

### 完了状況

| 指標 | 計画 | 実績 | 達成率 |
|------|------|------|--------|
| ストーリーポイント | 13SP | 13SP | 100% |
| ストーリー数 | 2 | 2 | 100% |
| 共通タスク | 5 件 | 5 件 | 100% |
| コミット数 | - | 41 | - |
| バックエンドテスト | - | 666 パス | ✅ |
| フロントエンドテスト | - | 507 パス | ✅ |
| ビルド状態 | - | 成功 | ✅ |

### 主要成果物

| ストーリーID | ストーリー名 | SP | 状態 | 完了日 |
|-------------|-------------|-----|------|--------|
| US-FS-001 | 貸借対照表表示 | 8 | ✅ 完了 | 2026-02-14 |
| US-LDG-002 | 補助元帳照会 | 5 | ✅ 完了 | 2026-02-14 |

### 共通タスク完了状況

| タスクID | タスク名 | 状態 | 備考 |
|----------|---------|------|------|
| COMMON-18 | リリース 1.0 MVP リリースノート作成 | ✅ 完了 | 2026-02-16 |
| COMMON-19 | API ドキュメント更新（Swagger） | ✅ 完了 | 実装済み確認 |
| COMMON-23 | 仕訳ステータス遷移図ドキュメント作成 | ✅ 完了 | 2026-02-16 |
| COMMON-24 | フロントエンド権限チェック | ✅ 完了 | 2026-02-16 |
| COMMON-25 | E2E テスト CI 統合 | ✅ 完了 | 実装済み確認 |

### コード変更統計

| メトリクス | 値 |
|-----------|-----|
| 総コミット数 | 41 |
| 変更ファイル数 | 337 |
| 追加行数 | 14,225 |
| 削除行数 | 3,145 |
| 純増行数 | 11,080 |
| コミット内訳 - refactor | 12 |
| コミット内訳 - fix | 9 |
| コミット内訳 - feat | 7 |
| コミット内訳 - docs | 7 |
| コミット内訳 - test | 5 |
| コミット内訳 - chore | 1 |

---

## KPT 分析

### Keep（続けること）

#### 技術的成功事項

1. **貸借対照表の包括的な実装**

   - バックエンド API、フロントエンド UI、PDF/Excel エクスポートを一括実装
   - 前期比較機能（差額・増減率計算）を含む完成度の高い実装
   - CSS Grid による勘定式レイアウトの実現

2. **ヘキサゴナルアーキテクチャパターンの成熟と再利用**

   - BalanceSheetRepository（Output Port）+ MyBatis mapper のパターンが確立
   - 総勘定元帳パターンの再利用で補助元帳照会を効率的に実装
   - Try\<T\> ラッピングによるエラーハンドリングの統一

3. **PMD 関数型プログラミングルールの導入と全対応**

   - AvoidThrowStatement、AvoidCheckedExceptionDeclaration 等 4 ルールを追加
   - 既存コード全件の違反を解消（12 refactor コミット）
   - Repository の Try\<T\> ラッピング、Value Object の validated() パターン確立

4. **テストカバレッジの高水準維持**

   - バックエンド 91.3%、フロントエンド 90.9%
   - SonarQube 指摘に対応しユニットテスト 63 件追加（バックエンド 20 件 + フロントエンド 43 件）

5. **3 イテレーション連続の共通タスク負債を完全解消**

   - COMMON-18〜25 の全 5 タスクを IT-7 初日で完了
   - リリースノート、ステータス遷移図、フロントエンド権限チェック等を実装

#### プロセス的成功事項

1. **前倒し完了によるリファクタリング時間の確保**

   - ストーリーを IT-7 開始前（2/14）に完了させ、残り期間をリファクタリングに充当
   - PMD 関数型ルール対応、SonarQube カバレッジ改善、E2E テスト安定化を実施

2. **GitHub Project との同期維持**

   - Issue #31, #27 のクローズと Project ステータスの自動連動
   - リリース 2.0 Milestone 進捗 91% に到達

#### チームワーク

1. **Claude + Codex の並列開発が最大効率**

   - Claude: 設計・計画・E2E テスト・品質改善・ドキュメント・リファクタリング
   - Codex: TDD 実装・ユニットテスト・UI 実装
   - 両者の成果物統合フローが安定し、41 コミットを 3 日で生成

---

### Problem（問題点・課題）

#### 見積もり精度の継続的乖離

1. **計画期間と実績期間の大幅な乖離**

   - 計画: 10 日間（2026-02-16 〜 2026-03-02）
   - 実績: 3 日間（2026-02-14 〜 2026-02-16、開始前含む）
   - AI アシスタント活用時のベロシティが人間チーム前提の計画と 3〜4 倍乖離

2. **ストーリーポイントの意味の変容**

   - SP は相対的な複雑度を表すが、AI による実装では複雑度と工数の相関が変化
   - 従来の SP 見積もりが AI 開発の計画に適さない可能性

#### E2E テストの継続的な不安定性

1. **CI 環境での flaky テスト**

   - ページネーション表示件数変更テストの失敗（React 制御コンポーネントの楽観的更新不足）
   - フロントエンド権限チェック実装に伴う E2E テスト修正が必要に
   - 4 件の fix(e2e) コミットが発生

#### SonarQube Quality Gate の未確認

1. **Quality Gate パスの確認が未完了**

   - テストカバレッジは高水準を維持しているが、最終的な Quality Gate 確認が保留

---

### Try（次に試すこと）

| # | アクション | 責任者 | 期限 | 内容 | 期待効果 |
|---|-----------|--------|------|------|----------|
| 1 | 貸借対照表パターンの再利用 | Claude | IT-8 | 損益計算書で BalanceSheet のアーキテクチャパターン（Repository/Service/Controller）を再利用 | 実装時間の短縮 |
| 2 | ページネーション楽観的更新の横展開 | Claude | IT-8 | 他のページ（元帳系）にも同様の楽観的更新パターンを適用 | E2E テスト安定化 |
| 3 | SonarQube Quality Gate 確認 | Claude | IT-8 | IT-8 完了時に Quality Gate パスを確認・記録 | 品質保証 |
| 4 | リリース 2.0 統合テスト | Claude | IT-8 | 全機能の統合テスト実施、リリース準備 | リリース品質確保 |

---

## 次イテレーションへの引き継ぎ事項

### 必須対応事項

1. **US-FS-002: 損益計算書表示**（8SP）

   - 貸借対照表の実装パターンを再利用
   - 期間指定（dateFrom, dateTo）のクエリ拡張
   - 利益計算ロジック（売上総利益 → 営業利益 → 経常利益 → 当期純利益）

### リリース 2.0 完了条件

1. US-FS-002 損益計算書表示の全受入条件を満たす
2. リリース 2.0 全体の統合テスト実施
3. SonarQube Quality Gate パス

---

## メトリクス

### 開発メトリクス

| メトリクス | 値 |
|-----------|-----|
| 総コミット数 | 41 |
| 変更ファイル数 | 337 |
| 追加行数 | 14,225 |
| 削除行数 | 3,145 |
| 純増行数 | 11,080 |

### 品質メトリクス

| メトリクス | バックエンド | フロントエンド |
|-----------|-------------|---------------|
| テストケース数 | 666 | 507 |
| テストカバレッジ | 91.3% | 90.9% |
| ビルド状態 | ✅ 成功 | ✅ 成功 |

### プロセスメトリクス

| メトリクス | 計画 | 実績 |
|-----------|------|------|
| イテレーション期間 | 10 日 | 3 日 |
| ベロシティ | 13SP | 13SP |
| 達成率 | 100% | 100% |

---

## ベロシティ推移

### 全イテレーション実績

| イテレーション | 計画 SP | 実績 SP | 計画期間 | 実績期間 |
|---------------|---------|---------|----------|----------|
| 1 | 15 | 18 | 2 週間 | 2 週間 |
| 2 | 14 | 16 | 2 週間 | 1 週間 |
| 3 | 18 | 18 | 2 週間 | 1 週間 |
| 4 | 10 | 10 | 2 週間 | 2 日 |
| 5 | 17 | 17 | 2 週間 | 3 日 |
| 6 | 19 | 19 | 2 週間 | 4 日 |
| 7 | 13 | 13 | 2 週間 | 3 日 |
| **累計** | **106** | **111** | | |

**平均ベロシティ**: 15.9 SP/イテレーション

---

## 学び（Lessons Learned）

### 技術的学び

1. **React 制御コンポーネントの楽観的更新は必須**

   - API 呼び出し前に state を即座更新しないと、制御コンポーネントが旧値にリセットされる
   - CI のように API レスポンスが遅い環境で顕在化する

2. **PMD 関数型ルールの体系的導入が効果的**

   - AvoidThrowStatement → validated() / Either factory パターン
   - AvoidMutableCollectionInstantiation → List.of() / Collections.unmodifiable
   - Try\<T\> で Repository の戻り値を統一し、例外をドメイン外に隔離

3. **PDF/Excel エクスポートのパターンが確立**

   - Apache POI（Excel）+ OpenPDF（PDF）のサーバーサイド生成
   - フロントエンドからの Blob API ダウンロード
   - 損益計算書でも同パターンを再利用可能

### プロセス的学び

1. **共通タスクを計画に必須として組み込む効果**

   - IT-7 で COMMON-18〜25 を必須化し、初日に集中消化で全完了
   - 先送りを防ぐには計画段階で「必須」と明示することが有効

2. **リファクタリング期間の確保が品質向上に直結**

   - ストーリー前倒し完了後の期間で PMD ルール対応 12 コミットを実施
   - 関数型プログラミングパターンの導入により保守性が大幅向上

---

## 総評

### 成功した点

- **全ストーリー・共通タスク完了（13SP + 18h / 実質 3 日）**: 計画を大幅に前倒しで達成
- **貸借対照表の包括的実装**: 前期比較、PDF/Excel エクスポートを含む完成度の高い実装
- **3 イテレーション連続の共通タスク負債を完全解消**: COMMON-18〜25 全完了
- **PMD 関数型プログラミングルールの体系的導入**: 12 コミットで全違反を解消
- **テストカバレッジ高水準維持**: バックエンド 91.3%、フロントエンド 90.9%

### 改善が必要な点

- **ベロシティ見積もりの継続的乖離**: 計画 10 日 → 実績 3 日
- **E2E テストの安定性**: 制御コンポーネントの楽観的更新パターンを横展開すべき
- **SonarQube Quality Gate 確認**: 最終確認が保留

### 総合評価

イテレーション 7 は**大成功**でした。貸借対照表表示と補助元帳照会を実装し、3 イテレーション連続で先送りされていた共通タスクを全て解消しました。さらに、PMD 関数型プログラミングルールの体系的導入により、コードベース全体の保守性が向上しました。累計 111SP を完了し、プロジェクト全体の 72% が完了しています。

次のイテレーション 8 では損益計算書表示（US-FS-002 8SP）を実装し、リリース 2.0 機能拡張版を完了させます。

---

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|---------|--------|
| 2026-02-17 | 初版作成 | Claude Opus 4.6 |

---

## 関連ドキュメント

- [イテレーション 7 計画](./iteration_plan-7.md)
- [イテレーション 6 ふりかえり](./retrospective-6.md)
- [リリース計画](./release_plan.md)
